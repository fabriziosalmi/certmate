{% extends "base.html" %}
{% block title %}Settings - CertMate{% endblock %}
{% block content %}
    <!-- Main Content -->
    <div class="max-w-7xl mx-auto py-6 sm:px-6 lg:px-8"
         x-data="{ tab: (location.hash.slice(1) || 'dns') }"
         x-init="$watch('tab', t => history.replaceState(null, '', '#' + t))"
        <!-- Header -->
        <div class="bg-white dark:bg-gray-800 shadow rounded-lg mb-6">
            <div class="px-6 py-4">
                <h2 class="text-2xl font-bold text-gray-900 dark:text-white">Settings</h2>
                <p class="text-gray-600 dark:text-gray-300 mt-1">Configure your DNS provider credentials and preferences</p>
                <div class="mt-3 flex items-center text-sm">
                    <div class="flex items-center text-green-600 dark:text-green-400" id="connectionStatus" style="display: none;">
                        <i class="fas fa-check-circle mr-1"></i>
                        <span>Connected and configured</span>
                    </div>
                    <div class="flex items-center text-yellow-600 dark:text-yellow-400" id="partialStatus" style="display: none;">
                        <i class="fas fa-exclamation-triangle mr-1"></i>
                        <span>Partially configured</span>
                    </div>
                    <div class="flex items-center text-red-600 dark:text-red-400" id="disconnectedStatus" style="display: none;">
                        <i class="fas fa-times-circle mr-1"></i>
                        <span>Not configured</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Settings Tabs (Alpine.js) -->
        <div class="bg-white dark:bg-gray-800 shadow rounded-lg">
            <div class="px-6 py-3 border-b dark:border-gray-700 overflow-x-auto">
                <nav class="flex space-x-1 min-w-max" role="tablist">
                    <template x-for="t in [{id:'dns',icon:'fa-server',label:'DNS'},{id:'ca',icon:'fa-shield-alt',label:'CA'},{id:'general',icon:'fa-cogs',label:'General'},{id:'storage',icon:'fa-database',label:'Storage'},{id:'notifications',icon:'fa-bell',label:'Notifications'},{id:'users',icon:'fa-users',label:'Users'},{id:'backup',icon:'fa-archive',label:'Backup'}]">
                        <button type="button" @click="tab = t.id" role="tab"
                                :class="tab === t.id
                                    ? 'px-4 py-2 text-sm font-medium rounded-md text-primary bg-blue-50 dark:bg-blue-900/30 border border-blue-200 dark:border-blue-700'
                                    : 'px-4 py-2 text-sm font-medium rounded-md text-gray-600 dark:text-gray-300 hover:text-gray-900 dark:hover:text-white hover:bg-gray-100 dark:hover:bg-gray-700'">
                            <i class="fas" :class="t.icon" class="mr-1"></i><span class="hidden sm:inline" x-text="' ' + t.label"></span>
                        </button>
                    </template>
                </nav>
            </div>
            <div class="px-6 py-6">
                <form id="settingsForm" class="space-y-8">

                    <!-- TAB: DNS Providers -->
                    <div x-show="tab === 'dns'"
                    <!-- DNS Provider Selection -->
                    <div class="bg-gray-50 dark:bg-gray-700/50 p-4 rounded-lg">
                        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-3" id="dns-provider-label">
                            <i class="fas fa-server mr-1"></i>
                            DNS Providers
                        </label>
                        
                        <!-- Multi-Account Providers -->
                        <div class="mb-6">
                            <h4 class="text-sm font-semibold text-gray-700 dark:text-gray-300 mb-2 flex items-center">
                                <i class="fas fa-users mr-2 text-blue-500"></i>
                                Multi-Account Support
                                <span class="ml-2 text-xs bg-blue-100 dark:bg-blue-900/30 text-blue-800 dark:text-blue-300 px-2 py-0.5 rounded-full">Advanced</span>
                            </h4>
                            <div class="grid grid-cols-2 md:grid-cols-4 lg:grid-cols-6 xl:grid-cols-7 gap-2 mb-4" role="radiogroup" aria-labelledby="dns-provider-label">
                                <label class="relative">
                                    <input type="radio" name="dns_provider" value="cloudflare" class="sr-only peer">
                                    <div class="p-2 border-2 border-gray-200 dark:border-gray-600 rounded-lg cursor-pointer transition-all peer-checked:border-primary peer-checked:bg-blue-50 dark:bg-blue-900/20 dark:peer-checked:bg-blue-900/30 hover:border-gray-300 dark:hover:border-gray-500">
                                        <div class="text-center">
                                            <i class="fab fa-cloudflare text-lg text-orange-500 mb-1"></i>
                                            <div class="text-xs font-medium dark:text-white">Cloudflare</div>
                                            <div class="text-xs text-gray-500 dark:text-gray-400 mt-1" id="cloudflare-status">Not configured</div>
                                            <!-- Multi-account indicator -->
                                            <div class="text-xs text-blue-600 dark:text-blue-400 mt-1 hidden" id="cloudflare-accounts">
                                                <i class="fas fa-users text-xs mr-1"></i>
                                                <span id="cloudflare-account-count">0</span> accounts
                                            </div>
                                        </div>
                                    </div>
                                </label>
                                <label class="relative">
                                    <input type="radio" name="dns_provider" value="route53" class="sr-only peer">
                                    <div class="p-2 border-2 border-gray-200 dark:border-gray-600 rounded-lg cursor-pointer transition-all peer-checked:border-primary peer-checked:bg-blue-50 dark:bg-blue-900/20 dark:peer-checked:bg-blue-900/30 hover:border-gray-300 dark:hover:border-gray-500">
                                        <div class="text-center">
                                            <i class="fab fa-aws text-lg text-orange-400 mb-1"></i>
                                            <div class="text-xs font-medium dark:text-white">Route53</div>
                                            <div class="text-xs text-gray-500 dark:text-gray-400 mt-1" id="route53-status">Not configured</div>
                                            <!-- Multi-account indicator -->
                                            <div class="text-xs text-blue-600 dark:text-blue-400 mt-1 hidden" id="route53-accounts">
                                                <i class="fas fa-users text-xs mr-1"></i>
                                                <span id="route53-account-count">0</span> accounts
                                            </div>
                                        </div>
                                    </div>
                                </label>
                                <label class="relative">
                                    <input type="radio" name="dns_provider" value="digitalocean" class="sr-only peer">
                                    <div class="p-2 border-2 border-gray-200 dark:border-gray-600 rounded-lg cursor-pointer transition-all peer-checked:border-primary peer-checked:bg-blue-50 dark:bg-blue-900/20 dark:peer-checked:bg-blue-900/30 hover:border-gray-300 dark:hover:border-gray-500">
                                        <div class="text-center">
                                            <i class="fab fa-digital-ocean text-lg text-blue-600 mb-1"></i>
                                            <div class="text-xs font-medium dark:text-white">DigitalOcean</div>
                                            <div class="text-xs text-gray-500 dark:text-gray-400 mt-1" id="digitalocean-status">Not configured</div>
                                            <!-- Multi-account indicator -->
                                            <div class="text-xs text-blue-600 dark:text-blue-400 mt-1 hidden" id="digitalocean-accounts">
                                                <i class="fas fa-users text-xs mr-1"></i>
                                                <span id="digitalocean-account-count">0</span> accounts
                                            </div>
                                        </div>
                                    </div>
                                </label>
                                <label class="relative">
                                    <input type="radio" name="dns_provider" value="azure" class="sr-only peer">
                                    <div class="p-2 border-2 border-gray-200 dark:border-gray-600 rounded-lg cursor-pointer transition-all peer-checked:border-primary peer-checked:bg-blue-50 dark:bg-blue-900/20 dark:peer-checked:bg-blue-900/30 hover:border-gray-300 dark:hover:border-gray-500">
                                        <div class="text-center">
                                            <i class="fab fa-microsoft text-lg text-blue-600 mb-1"></i>
                                            <div class="text-xs font-medium dark:text-white">Azure DNS</div>
                                            <div class="text-xs text-gray-500 dark:text-gray-400 mt-1" id="azure-status">Not configured</div>
                                            <!-- Multi-account indicator -->
                                            <div class="text-xs text-blue-600 dark:text-blue-400 mt-1 hidden" id="azure-accounts">
                                                <i class="fas fa-users text-xs mr-1"></i>
                                                <span id="azure-account-count">0</span> accounts
                                            </div>
                                        </div>
                                    </div>
                                </label>
                                <label class="relative">
                                    <input type="radio" name="dns_provider" value="google" class="sr-only peer">
                                    <div class="p-2 border-2 border-gray-200 dark:border-gray-600 rounded-lg cursor-pointer transition-all peer-checked:border-primary peer-checked:bg-blue-50 dark:bg-blue-900/20 dark:peer-checked:bg-blue-900/30 hover:border-gray-300 dark:hover:border-gray-500">
                                        <div class="text-center">
                                            <i class="fab fa-google text-lg text-blue-500 mb-1"></i>
                                            <div class="text-xs font-medium dark:text-white">Google DNS</div>
                                            <div class="text-xs text-gray-500 dark:text-gray-400 mt-1" id="google-status">Not configured</div>
                                            <!-- Multi-account indicator -->
                                            <div class="text-xs text-blue-600 dark:text-blue-400 mt-1 hidden" id="google-accounts">
                                                <i class="fas fa-users text-xs mr-1"></i>
                                                <span id="google-account-count">0</span> accounts
                                            </div>
                                        </div>
                                    </div>
                                </label>
                                <label class="relative">
                                    <input type="radio" name="dns_provider" value="powerdns" class="sr-only peer">
                                    <div class="p-2 border-2 border-gray-200 dark:border-gray-600 rounded-lg cursor-pointer transition-all peer-checked:border-primary peer-checked:bg-blue-50 dark:bg-blue-900/20 dark:peer-checked:bg-blue-900/30 hover:border-gray-300 dark:hover:border-gray-500">
                                        <div class="text-center">
                                            <i class="fas fa-server text-lg text-gray-600 dark:text-gray-400 mb-1"></i>
                                            <div class="text-xs font-medium dark:text-white">PowerDNS</div>
                                            <div class="text-xs text-gray-500 dark:text-gray-400 mt-1" id="powerdns-status">Not configured</div>
                                            <!-- Multi-account indicator -->
                                            <div class="text-xs text-blue-600 dark:text-blue-400 mt-1 hidden" id="powerdns-accounts">
                                                <i class="fas fa-users text-xs mr-1"></i>
                                                <span id="powerdns-account-count">0</span> accounts
                                            </div>
                                        </div>
                                    </div>
                                </label>
                                <label class="relative">
                                    <input type="radio" name="dns_provider" value="rfc2136" class="sr-only peer">
                                    <div class="p-2 border-2 border-gray-200 dark:border-gray-600 rounded-lg cursor-pointer transition-all peer-checked:border-primary peer-checked:bg-blue-50 dark:bg-blue-900/20 dark:peer-checked:bg-blue-900/30 hover:border-gray-300 dark:hover:border-gray-500">
                                        <div class="text-center">
                                            <i class="fas fa-exchange-alt text-lg text-gray-600 dark:text-gray-400 mb-1"></i>
                                            <div class="text-xs font-medium dark:text-white">RFC2136</div>
                                            <div class="text-xs text-gray-500 dark:text-gray-400 mt-1" id="rfc2136-status">Not configured</div>
                                            <!-- Multi-account indicator -->
                                            <div class="text-xs text-blue-600 dark:text-blue-400 mt-1 hidden" id="rfc2136-accounts">
                                                <i class="fas fa-users text-xs mr-1"></i>
                                                <span id="rfc2136-account-count">0</span> accounts
                                            </div>
                                        </div>
                                    </div>
                                </label>
                            </div>
                        </div>
                        
                        <!-- Single-Account Providers -->
                        <div>
                            <h4 class="text-sm font-semibold text-gray-700 dark:text-gray-300 mb-2 flex items-center">
                                <i class="fas fa-user mr-2 text-gray-500"></i>
                                Single Account Providers
                                <span class="ml-2 text-xs bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300 px-2 py-0.5 rounded-full">Standard</span>
                            </h4>
                            <div class="grid grid-cols-2 md:grid-cols-4 lg:grid-cols-6 xl:grid-cols-8 gap-2" role="radiogroup" aria-labelledby="dns-provider-label">
                                <label class="relative">
                                    <input type="radio" name="dns_provider" value="linode" class="sr-only peer">
                                    <div class="p-2 border-2 border-gray-200 dark:border-gray-600 rounded-lg cursor-pointer transition-all peer-checked:border-primary peer-checked:bg-blue-50 dark:bg-blue-900/20 dark:peer-checked:bg-blue-900/30 hover:border-gray-300 dark:hover:border-gray-500">
                                        <div class="text-center">
                                            <i class="fas fa-cloud text-lg text-green-600 mb-1"></i>
                                            <div class="text-xs font-medium dark:text-white">Linode</div>
                                            <div class="text-xs text-gray-500 dark:text-gray-400 mt-1" id="linode-status">Not configured</div>
                                        </div>
                                    </div>
                                </label>
                                <label class="relative">
                                    <input type="radio" name="dns_provider" value="vultr" class="sr-only peer">
                                    <div class="p-2 border-2 border-gray-200 dark:border-gray-600 rounded-lg cursor-pointer transition-all peer-checked:border-primary peer-checked:bg-blue-50 dark:bg-blue-900/20 dark:peer-checked:bg-blue-900/30 hover:border-gray-300 dark:hover:border-gray-500">
                                        <div class="text-center">
                                            <i class="fas fa-cloud text-lg text-blue-600 mb-1"></i>
                                            <div class="text-xs font-medium dark:text-white">Vultr</div>
                                            <div class="text-xs text-gray-500 dark:text-gray-400 mt-1" id="vultr-status">Not configured</div>
                                        </div>
                                    </div>
                                </label>
                                <label class="relative">
                                    <input type="radio" name="dns_provider" value="hetzner" class="sr-only peer">
                                    <div class="p-2 border-2 border-gray-200 dark:border-gray-600 rounded-lg cursor-pointer transition-all peer-checked:border-primary peer-checked:bg-blue-50 dark:bg-blue-900/20 dark:peer-checked:bg-blue-900/30 hover:border-gray-300 dark:hover:border-gray-500">
                                        <div class="text-center">
                                            <i class="fas fa-server text-lg text-red-600 mb-1"></i>
                                            <div class="text-xs font-medium dark:text-white">Hetzner</div>
                                            <div class="text-xs text-gray-500 dark:text-gray-400 mt-1" id="hetzner-status">Not configured</div>
                                        </div>
                                    </div>
                                </label>
                                <label class="relative">
                                    <input type="radio" name="dns_provider" value="gandi" class="sr-only peer">
                                    <div class="p-2 border-2 border-gray-200 dark:border-gray-600 rounded-lg cursor-pointer transition-all peer-checked:border-primary peer-checked:bg-blue-50 dark:bg-blue-900/20 dark:peer-checked:bg-blue-900/30 hover:border-gray-300 dark:hover:border-gray-500">
                                        <div class="text-center">
                                            <i class="fas fa-globe text-lg text-orange-600 mb-1"></i>
                                            <div class="text-xs font-medium dark:text-white">Gandi</div>
                                            <div class="text-xs text-gray-500 dark:text-gray-400 mt-1" id="gandi-status">Not configured</div>
                                        </div>
                                    </div>
                                </label>
                                <label class="relative">
                                    <input type="radio" name="dns_provider" value="ovh" class="sr-only peer">
                                    <div class="p-2 border-2 border-gray-200 dark:border-gray-600 rounded-lg cursor-pointer transition-all peer-checked:border-primary peer-checked:bg-blue-50 dark:bg-blue-900/20 dark:peer-checked:bg-blue-900/30 hover:border-gray-300 dark:hover:border-gray-500">
                                        <div class="text-center">
                                            <i class="fas fa-server text-lg text-purple-600 mb-1"></i>
                                            <div class="text-xs font-medium dark:text-white">OVH</div>
                                            <div class="text-xs text-gray-500 dark:text-gray-400 mt-1" id="ovh-status">Not configured</div>
                                        </div>
                                    </div>
                                </label>
                                <label class="relative">
                                    <input type="radio" name="dns_provider" value="namecheap" class="sr-only peer">
                                    <div class="p-2 border-2 border-gray-200 dark:border-gray-600 rounded-lg cursor-pointer transition-all peer-checked:border-primary peer-checked:bg-blue-50 dark:bg-blue-900/20 dark:peer-checked:bg-blue-900/30 hover:border-gray-300 dark:hover:border-gray-500">
                                        <div class="text-center">
                                            <i class="fas fa-shopping-cart text-lg text-red-600 mb-1"></i>
                                            <div class="text-xs font-medium dark:text-white">Namecheap</div>
                                            <div class="text-xs text-gray-500 dark:text-gray-400 mt-1" id="namecheap-status">Not configured</div>
                                        </div>
                                    </div>
                                </label>
                                <label class="relative">
                                    <input type="radio" name="dns_provider" value="porkbun" class="sr-only peer">
                                    <div class="p-2 border-2 border-gray-200 dark:border-gray-600 rounded-lg cursor-pointer transition-all peer-checked:border-primary peer-checked:bg-blue-50 dark:bg-blue-900/20 dark:peer-checked:bg-blue-900/30 hover:border-gray-300 dark:hover:border-gray-500">
                                        <div class="text-center">
                                            <i class="fas fa-paw text-lg text-pink-600 mb-1"></i>
                                            <div class="text-xs font-medium dark:text-white">Porkbun</div>
                                            <div class="text-xs text-gray-500 dark:text-gray-400 mt-1" id="porkbun-status">Not configured</div>
                                        </div>
                                    </div>
                                </label>
                                <label class="relative">
                                    <input type="radio" name="dns_provider" value="godaddy" class="sr-only peer">
                                    <div class="p-2 border-2 border-gray-200 dark:border-gray-600 rounded-lg cursor-pointer transition-all peer-checked:border-primary peer-checked:bg-blue-50 dark:bg-blue-900/20 dark:peer-checked:bg-blue-900/30 hover:border-gray-300 dark:hover:border-gray-500">
                                        <div class="text-center">
                                            <i class="fas fa-globe text-lg text-green-600 mb-1"></i>
                                            <div class="text-xs font-medium dark:text-white">GoDaddy</div>
                                            <div class="text-xs text-gray-500 dark:text-gray-400 mt-1" id="godaddy-status">Not configured</div>
                                        </div>
                                    </div>
                                </label>
                                <label class="relative">
                                    <input type="radio" name="dns_provider" value="dnsmadeeasy" class="sr-only peer">
                                    <div class="p-2 border-2 border-gray-200 dark:border-gray-600 rounded-lg cursor-pointer transition-all peer-checked:border-primary peer-checked:bg-blue-50 dark:bg-blue-900/20 dark:peer-checked:bg-blue-900/30 hover:border-gray-300 dark:hover:border-gray-500">
                                        <div class="text-center">
                                            <i class="fas fa-cogs text-lg text-green-600 mb-1"></i>
                                            <div class="text-xs font-medium dark:text-white">DNS Made Easy</div>
                                            <div class="text-xs text-gray-500 dark:text-gray-400 mt-1" id="dnsmadeeasy-status">Not configured</div>
                                        </div>
                                    </div>
                                </label>
                                <label class="relative">
                                    <input type="radio" name="dns_provider" value="nsone" class="sr-only peer">
                                    <div class="p-2 border-2 border-gray-200 dark:border-gray-600 rounded-lg cursor-pointer transition-all peer-checked:border-primary peer-checked:bg-blue-50 dark:bg-blue-900/20 dark:peer-checked:bg-blue-900/30 hover:border-gray-300 dark:hover:border-gray-500">
                                        <div class="text-center">
                                            <i class="fas fa-network-wired text-lg text-indigo-600 mb-1"></i>
                                            <div class="text-xs font-medium dark:text-white">NS1</div>
                                            <div class="text-xs text-gray-500 dark:text-gray-400 mt-1" id="nsone-status">Not configured</div>
                                        </div>
                                    </div>
                                </label>
                                <label class="relative">
                                    <input type="radio" name="dns_provider" value="he-ddns" class="sr-only peer">
                                    <div class="p-2 border-2 border-gray-200 dark:border-gray-600 rounded-lg cursor-pointer transition-all peer-checked:border-primary peer-checked:bg-blue-50 dark:bg-blue-900/20 dark:peer-checked:bg-blue-900/30 hover:border-gray-300 dark:hover:border-gray-500">
                                        <div class="text-center">
                                            <i class="fas fa-bolt text-lg text-yellow-600 mb-1"></i>
                                            <div class="text-xs font-medium dark:text-white">Hurricane Electric</div>
                                            <div class="text-xs text-gray-500 dark:text-gray-400 mt-1" id="he-ddns-status">Not configured</div>
                                        </div>
                                    </div>
                                </label>
                                <label class="relative">
                                    <input type="radio" name="dns_provider" value="dynudns" class="sr-only peer">
                                    <div class="p-2 border-2 border-gray-200 dark:border-gray-600 rounded-lg cursor-pointer transition-all peer-checked:border-primary peer-checked:bg-blue-50 dark:bg-blue-900/20 dark:peer-checked:bg-blue-900/30 hover:border-gray-300 dark:hover:border-gray-500">
                                        <div class="text-center">
                                            <i class="fas fa-sync-alt text-lg text-purple-600 mb-1"></i>
                                            <div class="text-xs font-medium dark:text-white">Dynu</div>
                                            <div class="text-xs text-gray-500 dark:text-gray-400 mt-1" id="dynudns-status">Not configured</div>
                                        </div>
                                    </div>
                                </label>
                            </div>
                        </div>
                    </div>

                    <!-- DNS Provider Configurations -->
                    <!-- Cloudflare Configuration -->
                    <div id="cloudflare-config" class="dns-config hidden">
                        <div class="border border-orange-200 dark:border-orange-600 rounded-lg p-4 bg-orange-50 dark:bg-orange-900/20">
                            <div class="flex items-center justify-between mb-4">
                                <h4 class="text-lg font-medium text-gray-900 dark:text-white">
                                    <i class="fab fa-cloudflare mr-2 text-orange-500"></i>
                                    Cloudflare Configuration
                                </h4>
                                <button type="button" id="cloudflare-add-account" onclick="showAddAccountModal('cloudflare')" 
                                        class="inline-flex items-center px-3 py-1.5 border border-transparent text-xs font-medium rounded-md text-white bg-primary hover:bg-secondary focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary">
                                    <i class="fas fa-plus mr-1"></i>
                                    Add Account
                                </button>
                            </div>
                            
                            <!-- Account Management List -->
                            <div id="cloudflare-accounts-list" class="space-y-3 mb-4">
                                <!-- Accounts will be populated here -->
                            </div>
                            
                            <!-- Legacy single account fields (hidden when multi-account mode is active) -->
                            <div id="cloudflare-legacy-config">
                                <label for="cloudflare_api_token" class="block text-sm font-medium text-gray-700 dark:text-gray-300">
                                    API Token
                                </label>
                                <div class="mt-1">
                                    <input type="password" id="cloudflare_api_token" name="cloudflare_api_token" 
                                           class="block w-full border border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-primary focus:border-primary"
                                           placeholder="Enter your Cloudflare API token"
                                           autocomplete="new-password" 
                                           spellcheck="false"
                                           data-lpignore="true">
                                </div>
                                <p class="mt-2 text-sm text-gray-600 dark:text-gray-300">
                                    Create an API token at <a href="https://dash.cloudflare.com/profile/api-tokens" target="_blank" class="text-primary hover:underline">Cloudflare Dashboard</a> with <strong>Zone:DNS:Edit</strong> permissions.
                                </p>
                            </div>
                        </div>
                    </div>

                    <!-- AWS Route53 Configuration -->
                    <div id="route53-config" class="dns-config hidden">
                        <div class="border border-orange-200 dark:border-orange-600 rounded-lg p-4 bg-orange-50 dark:bg-orange-900/20">
                            <div class="flex items-center justify-between mb-4">
                                <h4 class="text-lg font-medium text-gray-900 dark:text-white">
                                    <i class="fab fa-aws mr-2 text-orange-400"></i>
                                    AWS Route53 Configuration
                                </h4>
                                <button type="button" id="route53-add-account" onclick="showAddAccountModal('route53')" 
                                        class="inline-flex items-center px-3 py-1.5 border border-transparent text-xs font-medium rounded-md text-white bg-primary hover:bg-secondary focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary">
                                    <i class="fas fa-plus mr-1"></i>
                                    Add Account
                                </button>
                            </div>
                            
                            <!-- Account Management List -->
                            <div id="route53-accounts-list" class="space-y-3 mb-4">
                                <!-- Accounts will be populated here -->
                            </div>
                            
                            <!-- Legacy single account fields (hidden when multi-account mode is active) -->
                            <div id="route53-legacy-config">
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                    <div>
                                        <label for="route53_access_key_id" class="block text-sm font-medium text-gray-700 dark:text-gray-300">
                                            Access Key ID
                                        </label>
                                        <input type="password" id="route53_access_key_id" name="route53_access_key_id" 
                                               class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-primary focus:border-primary"
                                               placeholder="AKIAIOSFODNN7EXAMPLE"
                                               autocomplete="new-password" 
                                               spellcheck="false"
                                               data-lpignore="true">
                                    </div>
                                    <div>
                                        <label for="route53_secret_access_key" class="block text-sm font-medium text-gray-700 dark:text-gray-300">
                                            Secret Access Key
                                        </label>
                                        <input type="password" id="route53_secret_access_key" name="route53_secret_access_key" 
                                               class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-primary focus:border-primary"
                                               placeholder="Your AWS secret access key"
                                               autocomplete="new-password" 
                                               spellcheck="false"
                                               data-lpignore="true">
                                    </div>
                                    <div>
                                        <label for="route53_region" class="block text-sm font-medium text-gray-700 dark:text-gray-300">
                                            Region (Optional)
                                        </label>
                                        <input type="text" id="route53_region" name="route53_region" 
                                               class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-primary focus:border-primary"
                                               placeholder="us-east-1" value="us-east-1">
                                    </div>
                                </div>
                                <p class="mt-2 text-sm text-gray-600 dark:text-gray-300">
                                    Create IAM credentials with <strong>Route53FullAccess</strong> policy or a custom policy with Route53 DNS permissions.
                                </p>
                            </div>
                        </div>
                    </div>

                    <!-- Azure DNS Configuration -->
                    <div id="azure-config" class="dns-config hidden">
                        <div class="border border-orange-200 dark:border-orange-600 rounded-lg p-4 bg-orange-50 dark:bg-orange-900/20">
                            <div class="flex items-center justify-between mb-4">
                                <h4 class="text-lg font-medium text-gray-900 dark:text-white">
                                    <i class="fab fa-microsoft mr-2 text-blue-600"></i>
                                    Azure DNS Configuration
                                </h4>
                                <button type="button" id="azure-add-account" onclick="showAddAccountModal('azure')" 
                                        class="inline-flex items-center px-3 py-1.5 border border-transparent text-xs font-medium rounded-md text-white bg-primary hover:bg-secondary focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary">
                                    <i class="fas fa-plus mr-1"></i>
                                    Add Account
                                </button>
                            </div>
                            
                            <!-- Account Management List -->
                            <div id="azure-accounts-list" class="space-y-3 mb-4">
                                <!-- Accounts will be populated here -->
                            </div>
                            
                            <!-- Legacy single account fields (hidden when multi-account mode is active) -->
                            <div id="azure-legacy-config">
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                    <div>
                                        <label for="azure_subscription_id" class="block text-sm font-medium text-gray-700 dark:text-gray-300">
                                            Subscription ID
                                        </label>
                                        <input type="text" id="azure_subscription_id" name="azure_subscription_id" 
                                               class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-primary focus:border-primary"
                                               placeholder="12345678-1234-1234-1234-123456789012">
                                    </div>
                                    <div>
                                        <label for="azure_resource_group" class="block text-sm font-medium text-gray-700 dark:text-gray-300">
                                            Resource Group
                                        </label>
                                        <input type="text" id="azure_resource_group" name="azure_resource_group" 
                                               class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-primary focus:border-primary"
                                               placeholder="my-dns-resource-group">
                                    </div>
                                    <div>
                                        <label for="azure_tenant_id" class="block text-sm font-medium text-gray-700 dark:text-gray-300">
                                            Tenant ID
                                        </label>
                                        <input type="text" id="azure_tenant_id" name="azure_tenant_id" 
                                               class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-primary focus:border-primary"
                                               placeholder="12345678-1234-1234-1234-123456789012">
                                    </div>
                                    <div>
                                        <label for="azure_client_id" class="block text-sm font-medium text-gray-700 dark:text-gray-300">
                                            Client ID
                                        </label>
                                        <input type="text" id="azure_client_id" name="azure_client_id" 
                                               class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-primary focus:border-primary"
                                               placeholder="12345678-1234-1234-1234-123456789012">
                                    </div>
                                    <div class="md:col-span-2">
                                        <label for="azure_client_secret" class="block text-sm font-medium text-gray-700 dark:text-gray-300">
                                            Client Secret
                                        </label>
                                        <input type="password" id="azure_client_secret" name="azure_client_secret" 
                                               class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-primary focus:border-primary"
                                               placeholder="Your Azure client secret"
                                               autocomplete="new-password" 
                                               spellcheck="false"
                                               data-lpignore="true">
                                    </div>
                                </div>
                                <p class="mt-2 text-sm text-gray-600 dark:text-gray-300">
                                    Create a Service Principal with <strong>DNS Zone Contributor</strong> role for your DNS zones.
                                </p>
                            </div>
                        </div>
                    </div>

                    <!-- Google Cloud DNS Configuration -->
                    <div id="google-config" class="dns-config hidden">
                        <div class="border border-orange-200 dark:border-orange-600 rounded-lg p-4 bg-orange-50 dark:bg-orange-900/20">
                            <div class="flex items-center justify-between mb-4">
                                <h4 class="text-lg font-medium text-gray-900 dark:text-white">
                                    <i class="fab fa-google mr-2 text-blue-500"></i>
                                    Google Cloud DNS Configuration
                                </h4>
                                <button type="button" id="google-add-account" onclick="showAddAccountModal('google')" 
                                        class="inline-flex items-center px-3 py-1.5 border border-transparent text-xs font-medium rounded-md text-white bg-primary hover:bg-secondary focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary">
                                    <i class="fas fa-plus mr-1"></i>
                                    Add Account
                                </button>
                            </div>
                            
                            <!-- Account Management List -->
                            <div id="google-accounts-list" class="space-y-3 mb-4">
                                <!-- Accounts will be populated here -->
                            </div>
                            
                            <!-- Legacy single account fields (hidden when multi-account mode is active) -->
                            <div id="google-legacy-config">
                                <div class="space-y-4">
                                    <div>
                                        <label for="google_project_id" class="block text-sm font-medium text-gray-700 dark:text-gray-300">
                                            Project ID
                                        </label>
                                        <input type="text" id="google_project_id" name="google_project_id" 
                                               class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-primary focus:border-primary"
                                               placeholder="my-gcp-project-123456">
                                    </div>
                                    <div>
                                        <label for="google_service_account_key" class="block text-sm font-medium text-gray-700 dark:text-gray-300">
                                            Service Account JSON Key
                                        </label>
                                        <textarea id="google_service_account_key" name="google_service_account_key" rows="4"
                                               class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-primary focus:border-primary"
                                               placeholder='{"type": "service_account", "project_id": "...", ...}'></textarea>
                                    </div>
                                </div>
                                <p class="mt-2 text-sm text-gray-600 dark:text-gray-300">
                                    Create a Service Account with <strong>DNS Administrator</strong> role and download the JSON key file.
                                </p>
                            </div>
                        </div>
                    </div>

                    <!-- PowerDNS Configuration -->
                    <div id="powerdns-config" class="dns-config hidden">
                        <div class="border border-orange-200 dark:border-orange-600 rounded-lg p-4 bg-orange-50 dark:bg-orange-900/20">
                            <div class="flex items-center justify-between mb-4">
                                <h4 class="text-lg font-medium text-gray-900 dark:text-white">
                                    <i class="fas fa-server mr-2 text-gray-600"></i>
                                    PowerDNS Configuration
                                </h4>
                                <button type="button" id="powerdns-add-account" onclick="showAddAccountModal('powerdns')" 
                                        class="inline-flex items-center px-3 py-1.5 border border-transparent text-xs font-medium rounded-md text-white bg-primary hover:bg-secondary focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary">
                                    <i class="fas fa-plus mr-1"></i>
                                    Add Account
                                </button>
                            </div>
                            
                            <!-- Account Management List -->
                            <div id="powerdns-accounts-list" class="space-y-3 mb-4">
                                <!-- Accounts will be populated here -->
                            </div>
                            
                            <!-- Legacy single account fields (hidden when multi-account mode is active) -->
                            <div id="powerdns-legacy-config">
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                    <div>
                                        <label for="powerdns_api_url" class="block text-sm font-medium text-gray-700 dark:text-gray-300">
                                            API URL
                                        </label>
                                        <input type="url" id="powerdns_api_url" name="powerdns_api_url" 
                                               class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-primary focus:border-primary"
                                               placeholder="https://powerdns.example.com:8081">
                                    </div>
                                    <div>
                                        <label for="powerdns_api_key" class="block text-sm font-medium text-gray-700 dark:text-gray-300">
                                            API Key
                                        </label>
                                        <input type="password" id="powerdns_api_key" name="powerdns_api_key" 
                                               class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-primary focus:border-primary"
                                               placeholder="Your PowerDNS API key"
                                               autocomplete="new-password" 
                                               spellcheck="false"
                                               data-lpignore="true">
                                    </div>
                                </div>
                                <p class="mt-2 text-sm text-gray-600 dark:text-gray-300">
                                    Configure your PowerDNS server with API access enabled and provide the API endpoint and key.
                                </p>
                            </div>
                        </div>
                    </div>

                    <!-- DigitalOcean Configuration -->
                    <div id="digitalocean-config" class="dns-config hidden">
                        <div class="border border-orange-200 dark:border-orange-600 rounded-lg p-4 bg-orange-50 dark:bg-orange-900/20">
                            <div class="flex items-center justify-between mb-4">
                                <h4 class="text-lg font-medium text-gray-900 dark:text-white">
                                    <i class="fab fa-digital-ocean mr-2 text-blue-600"></i>
                                    DigitalOcean DNS Configuration
                                </h4>
                                <button type="button" id="digitalocean-add-account" onclick="showAddAccountModal('digitalocean')" 
                                        class="inline-flex items-center px-3 py-1.5 border border-transparent text-xs font-medium rounded-md text-white bg-primary hover:bg-secondary focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary">
                                    <i class="fas fa-plus mr-1"></i>
                                    Add Account
                                </button>
                            </div>
                            
                            <!-- Account Management List -->
                            <div id="digitalocean-accounts-list" class="space-y-3 mb-4">
                                <!-- Accounts will be populated here -->
                            </div>
                            
                            <!-- Legacy single account fields (hidden when multi-account mode is active) -->
                            <div id="digitalocean-legacy-config">
                                <div class="grid grid-cols-1 gap-4">
                                    <div>
                                        <label for="digitalocean_api_token" class="block text-sm font-medium text-gray-700 dark:text-gray-300">
                                            API Token
                                        </label>
                                        <input type="password" id="digitalocean_api_token" name="digitalocean_api_token" 
                                               class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-primary focus:border-primary"
                                               placeholder="Your DigitalOcean API token"
                                               autocomplete="new-password" 
                                               spellcheck="false"
                                               data-lpignore="true">
                                    </div>
                                </div>
                                <p class="mt-2 text-sm text-gray-600 dark:text-gray-300">
                                    Generate a personal access token from your DigitalOcean control panel with read/write permissions for DNS.
                                </p>
                            </div>
                        </div>
                    </div>

                    <!-- Vultr Configuration -->
                    <div id="vultr-config" class="dns-config hidden">
                        <div class="border border-orange-200 dark:border-orange-600 rounded-lg p-4 bg-orange-50 dark:bg-orange-900/20">
                            <div class="flex items-center justify-between mb-4">
                                <h4 class="text-lg font-medium text-gray-900 dark:text-white">
                                    <i class="fas fa-cloud mr-2 text-blue-600"></i>
                                    Vultr DNS Configuration
                                </h4>
                                <button type="button" id="vultr-add-account" onclick="showAddAccountModal('vultr')" 
                                        class="inline-flex items-center px-3 py-1.5 border border-transparent text-xs font-medium rounded-md text-white bg-primary hover:bg-secondary focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary">
                                    <i class="fas fa-plus mr-1"></i>
                                    Add Account
                                </button>
                            </div>
                            
                            <!-- Account Management List -->
                            <div id="vultr-accounts-list" class="space-y-3 mb-4">
                                <!-- Accounts will be populated here -->
                            </div>
                            
                            <!-- Legacy single account fields (hidden when multi-account mode is active) -->
                            <div id="vultr-legacy-config">
                                <label for="vultr_api_key" class="block text-sm font-medium text-gray-700 dark:text-gray-300">
                                    API Key
                                </label>
                                <div class="mt-1">
                                    <input type="password" id="vultr_api_key" name="vultr_api_key" 
                                           class="block w-full border border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-primary focus:border-primary"
                                           placeholder="Enter your Vultr API key">
                                </div>
                                <p class="mt-2 text-sm text-gray-600 dark:text-gray-300">
                                    Generate an API key from your Vultr control panel with DNS permissions.
                                </p>
                            </div>
                        </div>
                    </div>

                    <!-- Linode Configuration -->
                    <div id="linode-config" class="dns-config hidden">
                        <div class="border border-orange-200 dark:border-orange-600 rounded-lg p-4 bg-orange-50 dark:bg-orange-900/20">
                            <h4 class="text-lg font-medium text-gray-900 dark:text-white mb-4">
                                <i class="fas fa-cloud mr-2 text-green-600"></i>
                                Linode DNS Configuration
                            </h4>
                            <div class="grid grid-cols-1 gap-4">
                                <div>
                                    <label for="linode_api_key" class="block text-sm font-medium text-gray-700 dark:text-gray-300">
                                        API Key
                                    </label>
                                    <input type="password" id="linode_api_key" name="linode_api_key" 
                                           class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-primary focus:border-primary"
                                           placeholder="Your Linode API key">
                                </div>
                            </div>
                            <p class="mt-2 text-sm text-gray-600 dark:text-gray-300">
                                Create a personal access token from your Linode account with read/write access to DNS records.
                            </p>
                        </div>
                    </div>

                    <!-- Gandi Configuration -->
                    <div id="gandi-config" class="dns-config hidden">
                        <div class="border border-orange-200 dark:border-orange-600 rounded-lg p-4 bg-orange-50 dark:bg-orange-900/20">
                            <h4 class="text-lg font-medium text-gray-900 dark:text-white mb-4">
                                <i class="fas fa-globe mr-2 text-orange-600"></i>
                                Gandi DNS Configuration
                            </h4>
                            <div class="grid grid-cols-1 gap-4">
                                <div>
                                    <label for="gandi_api_token" class="block text-sm font-medium text-gray-700 dark:text-gray-300">
                                        API Token
                                    </label>
                                    <input type="password" id="gandi_api_token" name="gandi_api_token" 
                                           class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-primary focus:border-primary"
                                           placeholder="Your Gandi LiveDNS API token">
                                </div>
                            </div>
                            <p class="mt-2 text-sm text-gray-600 dark:text-gray-300">
                                Generate a personal access token from your Gandi account with DNS access permissions.
                            </p>
                        </div>
                    </div>

                    <!-- OVH Configuration -->
                    <div id="ovh-config" class="dns-config hidden">
                        <div class="border border-orange-200 dark:border-orange-600 rounded-lg p-4 bg-orange-50 dark:bg-orange-900/20">
                            <h4 class="text-lg font-medium text-gray-900 dark:text-white mb-4">
                                <i class="fas fa-server mr-2 text-purple-600"></i>
                                OVH DNS Configuration
                            </h4>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                <div>
                                    <label for="ovh_endpoint" class="block text-sm font-medium text-gray-700 dark:text-gray-300">
                                        Endpoint
                                    </label>
                                    <select id="ovh_endpoint" name="ovh_endpoint" 
                                            class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-primary focus:border-primary">
                                        <option value="">Select endpoint</option>
                                        <option value="ovh-eu">ovh-eu (Europe)</option>
                                        <option value="ovh-us">ovh-us (US)</option>
                                        <option value="ovh-ca">ovh-ca (Canada)</option>
                                        <option value="kimsufi-eu">kimsufi-eu</option>
                                        <option value="kimsufi-ca">kimsufi-ca</option>
                                        <option value="soyoustart-eu">soyoustart-eu</option>
                                        <option value="soyoustart-ca">soyoustart-ca</option>
                                    </select>
                                </div>
                                <div>
                                    <label for="ovh_application_key" class="block text-sm font-medium text-gray-700 dark:text-gray-300">
                                        Application Key
                                    </label>
                                    <input type="password" id="ovh_application_key" name="ovh_application_key" 
                                           class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-primary focus:border-primary"
                                           placeholder="Your application key">
                                </div>
                                <div>
                                    <label for="ovh_application_secret" class="block text-sm font-medium text-gray-700 dark:text-gray-300">
                                        Application Secret
                                    </label>
                                    <input type="password" id="ovh_application_secret" name="ovh_application_secret" 
                                           class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-primary focus:border-primary"
                                           placeholder="Your application secret">
                                </div>
                                <div>
                                    <label for="ovh_consumer_key" class="block text-sm font-medium text-gray-700 dark:text-gray-300">
                                        Consumer Key
                                    </label>
                                    <input type="password" id="ovh_consumer_key" name="ovh_consumer_key" 
                                           class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-primary focus:border-primary"
                                           placeholder="Your consumer key">
                                </div>
                            </div>
                            <p class="mt-2 text-sm text-gray-600 dark:text-gray-300">
                                Create an OVH application with DNS access permissions and configure the API credentials.
                            </p>
                        </div>
                    </div>

                    <!-- Namecheap Configuration -->
                    <div id="namecheap-config" class="dns-config hidden">
                        <div class="border border-orange-200 dark:border-orange-600 rounded-lg p-4 bg-orange-50 dark:bg-orange-900/20">
                            <h4 class="text-lg font-medium text-gray-900 dark:text-white mb-4">
                                <i class="fas fa-shopping-cart mr-2 text-red-600"></i>
                                Namecheap DNS Configuration
                            </h4>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                <div>
                                    <label for="namecheap_username" class="block text-sm font-medium text-gray-700 dark:text-gray-300">
                                        Username
                                    </label>
                                    <input type="text" id="namecheap_username" name="namecheap_username" 
                                           class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-primary focus:border-primary"
                                           placeholder="Your Namecheap username">
                                </div>
                                <div>
                                    <label for="namecheap_api_key" class="block text-sm font-medium text-gray-700 dark:text-gray-300">
                                        API Key
                                    </label>
                                    <input type="password" id="namecheap_api_key" name="namecheap_api_key" 
                                           class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-primary focus:border-primary"
                                           placeholder="Your Namecheap API key">
                                </div>
                            </div>
                            <p class="mt-2 text-sm text-gray-600 dark:text-gray-300">
                                Enable API access in your Namecheap account and provide your username and API key.
                            </p>
                        </div>
                    </div>

                    <!-- RFC2136 Configuration -->
                    <div id="rfc2136-config" class="dns-config hidden">
                        <div class="border border-orange-200 dark:border-orange-600 rounded-lg p-4 bg-orange-50 dark:bg-orange-900/20">
                            <div class="flex items-center justify-between mb-4">
                                <h4 class="text-lg font-medium text-gray-900 dark:text-white">
                                    <i class="fas fa-exchange-alt mr-2 text-gray-600"></i>
                                    RFC2136 DNS Configuration
                                </h4>
                                <button type="button" id="rfc2136-add-account" onclick="showAddAccountModal('rfc2136')" 
                                        class="inline-flex items-center px-3 py-1.5 border border-transparent text-xs font-medium rounded-md text-white bg-primary hover:bg-secondary focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary">
                                    <i class="fas fa-plus mr-1"></i>
                                    Add Server
                                </button>
                            </div>
                            
                            <!-- Account Management List -->
                            <div id="rfc2136-accounts-list" class="space-y-3 mb-4">
                                <!-- Accounts will be populated here -->
                            </div>
                            
                            <!-- Legacy single account fields (hidden when multi-account mode is active) -->
                            <div id="rfc2136-legacy-config">
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                    <div>
                                        <label for="rfc2136_nameserver" class="block text-sm font-medium text-gray-700 dark:text-gray-300">
                                            Nameserver
                                        </label>
                                        <input type="text" id="rfc2136_nameserver" name="rfc2136_nameserver" 
                                               class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-primary focus:border-primary"
                                               placeholder="ns.example.com">
                                    </div>
                                    <div>
                                        <label for="rfc2136_tsig_key" class="block text-sm font-medium text-gray-700 dark:text-gray-300">
                                            TSIG Key Name
                                        </label>
                                        <input type="text" id="rfc2136_tsig_key" name="rfc2136_tsig_key" 
                                               class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-primary focus:border-primary"
                                               placeholder="mykey">
                                    </div>
                                    <div>
                                        <label for="rfc2136_tsig_secret" class="block text-sm font-medium text-gray-700 dark:text-gray-300">
                                            TSIG Secret
                                        </label>
                                        <input type="password" id="rfc2136_tsig_secret" name="rfc2136_tsig_secret" 
                                               class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-primary focus:border-primary"
                                               placeholder="Base64-encoded secret">
                                    </div>
                                    <div>
                                        <label for="rfc2136_tsig_algorithm" class="block text-sm font-medium text-gray-700 dark:text-gray-300">
                                            TSIG Algorithm (Optional)
                                        </label>
                                        <select id="rfc2136_tsig_algorithm" name="rfc2136_tsig_algorithm" 
                                                class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-primary focus:border-primary">
                                            <option value="">Default (HMAC-MD5)</option>
                                            <option value="HMAC-MD5">HMAC-MD5</option>
                                            <option value="HMAC-SHA1">HMAC-SHA1</option>
                                            <option value="HMAC-SHA224">HMAC-SHA224</option>
                                            <option value="HMAC-SHA256">HMAC-SHA256</option>
                                            <option value="HMAC-SHA384">HMAC-SHA384</option>
                                            <option value="HMAC-SHA512">HMAC-SHA512</option>
                                        </select>
                                    </div>
                                </div>
                                <p class="mt-2 text-sm text-gray-600 dark:text-gray-300">
                                    Configure RFC2136 dynamic DNS updates for BIND or compatible DNS servers.
                                </p>
                            </div>
                        </div>
                    </div>

                    <!-- Additional Provider Configurations -->
                    
                    <!-- Hetzner Configuration -->
                    <div id="hetzner-config" class="dns-config hidden">
                        <div class="border border-orange-200 dark:border-orange-600 rounded-lg p-4 bg-orange-50 dark:bg-orange-900/20">
                            <h4 class="text-lg font-medium text-gray-900 dark:text-white mb-4">
                                <i class="fas fa-server mr-2 text-red-600"></i>
                                Hetzner DNS Configuration
                            </h4>
                            <div>
                                <label for="hetzner_api_token" class="block text-sm font-medium text-gray-700 dark:text-gray-300">
                                    API Token
                                </label>
                                <input type="password" id="hetzner_api_token" name="hetzner_api_token" 
                                       class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-primary focus:border-primary"
                                       placeholder="Your Hetzner DNS API token">
                            </div>
                            <p class="mt-2 text-sm text-gray-600 dark:text-gray-300">
                                Create an API token at <a href="https://dns.hetzner.com/" target="_blank" class="text-primary hover:underline">Hetzner DNS Console</a> with DNS zone permissions.
                            </p>
                        </div>
                    </div>

                    <!-- Porkbun Configuration -->
                    <div id="porkbun-config" class="dns-config hidden">
                        <div class="border border-orange-200 dark:border-orange-600 rounded-lg p-4 bg-orange-50 dark:bg-orange-900/20">
                            <h4 class="text-lg font-medium text-gray-900 dark:text-white mb-4">
                                <i class="fas fa-paw mr-2 text-pink-600"></i>
                                Porkbun DNS Configuration
                            </h4>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                <div>
                                    <label for="porkbun_api_key" class="block text-sm font-medium text-gray-700 dark:text-gray-300">
                                        API Key
                                    </label>
                                    <input type="password" id="porkbun_api_key" name="porkbun_api_key" 
                                           class="mt-1 block w-full border border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-primary focus:border-primary"
                                           placeholder="Your Porkbun API key">
                                </div>
                                <div>
                                    <label for="porkbun_secret_key" class="block text-sm font-medium text-gray-700 dark:text-gray-300">
                                        Secret Key
                                    </label>
                                    <input type="password" id="porkbun_secret_key" name="porkbun_secret_key" 
                                           class="mt-1 block w-full border border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-primary focus:border-primary"
                                           placeholder="Your Porkbun secret key">
                                </div>
                            </div>
                            <p class="mt-2 text-sm text-gray-600 dark:text-gray-300">
                                Get your API credentials from <a href="https://porkbun.com/account/api" target="_blank" class="text-primary hover:underline">Porkbun API page</a>.
                            </p>
                        </div>
                    </div>

                    <!-- GoDaddy Configuration -->
                    <div id="godaddy-config" class="dns-config hidden">
                        <div class="border border-orange-200 dark:border-orange-600 rounded-lg p-4 bg-orange-50 dark:bg-orange-900/20">
                            <h4 class="text-lg font-medium text-gray-900 dark:text-white mb-4">
                                <i class="fas fa-globe mr-2 text-green-600"></i>
                                GoDaddy DNS Configuration
                            </h4>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                <div>
                                    <label for="godaddy_api_key" class="block text-sm font-medium text-gray-700 dark:text-gray-300">
                                        API Key
                                    </label>
                                    <input type="password" id="godaddy_api_key" name="godaddy_api_key" 
                                           class="mt-1 block w-full border border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-primary focus:border-primary"
                                           placeholder="Your GoDaddy API key">
                                </div>
                                <div>
                                    <label for="godaddy_secret" class="block text-sm font-medium text-gray-700 dark:text-gray-300">
                                        API Secret
                                    </label>
                                    <input type="password" id="godaddy_secret" name="godaddy_secret" 
                                           class="mt-1 block w-full border border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-primary focus:border-primary"
                                           placeholder="Your GoDaddy API secret">
                                </div>
                            </div>
                            <p class="mt-2 text-sm text-gray-600 dark:text-gray-300">
                                Create API credentials at <a href="https://developer.godaddy.com/keys" target="_blank" class="text-primary hover:underline">GoDaddy Developer Portal</a>.
                            </p>
                        </div>
                    </div>

                    <!-- Hurricane Electric Configuration -->
                    <div id="he-ddns-config" class="dns-config hidden">
                        <div class="border border-orange-200 dark:border-orange-600 rounded-lg p-4 bg-orange-50 dark:bg-orange-900/20">
                            <h4 class="text-lg font-medium text-gray-900 dark:text-white mb-4">
                                <i class="fas fa-bolt mr-2 text-yellow-600"></i>
                                Hurricane Electric DNS Configuration
                            </h4>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                <div>
                                    <label for="he_ddns_username" class="block text-sm font-medium text-gray-700 dark:text-gray-300">
                                        Username
                                    </label>
                                    <input type="text" id="he_ddns_username" name="he_ddns_username" 
                                           class="mt-1 block w-full border border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-primary focus:border-primary"
                                           placeholder="Your Hurricane Electric username">
                                </div>
                                <div>
                                    <label for="he_ddns_password" class="block text-sm font-medium text-gray-700 dark:text-gray-300">
                                        Password
                                    </label>
                                    <input type="password" id="he_ddns_password" name="he_ddns_password" 
                                           class="mt-1 block w-full border border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-primary focus:border-primary"
                                           placeholder="Your Hurricane Electric password">
                                </div>
                            </div>
                            <p class="mt-2 text-sm text-gray-600 dark:text-gray-300">
                                Use your <a href="https://dns.he.net/" target="_blank" class="text-primary hover:underline">Hurricane Electric DNS</a> account credentials.
                            </p>
                        </div>
                    </div>

                    <!-- Dynu Configuration -->
                    <div id="dynudns-config" class="dns-config hidden">
                        <div class="border border-orange-200 dark:border-orange-600 rounded-lg p-4 bg-orange-50 dark:bg-orange-900/20">
                            <h4 class="text-lg font-medium text-gray-900 dark:text-white mb-4">
                                <i class="fas fa-sync-alt mr-2 text-purple-600"></i>
                                Dynu DNS Configuration
                            </h4>
                            <div>
                                <label for="dynudns_token" class="block text-sm font-medium text-gray-700 dark:text-gray-300">
                                    API Token
                                </label>
                                <input type="password" id="dynudns_token" name="dynudns_token" 
                                       class="mt-1 block w-full border border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-primary focus:border-primary"
                                       placeholder="Your Dynu API token">
                            </div>
                            <p class="mt-2 text-sm text-gray-600 dark:text-gray-300">
                                Generate an API token at <a href="https://www.dynu.com/en-US/ControlPanel/APICredentials" target="_blank" class="text-primary hover:underline">Dynu Control Panel</a>.
                            </p>
                        </div>
                    </div>
                    </div><!-- /tab: dns -->

                    <!-- TAB: CA Providers -->
                    <div x-show="tab === 'ca'" x-cloak
                    <!-- CA Providers Section -->
                    <div class="bg-gray-50 dark:bg-gray-700/50 p-4 rounded-lg">
                        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-3">
                            <i class="fas fa-certificate mr-1"></i>
                            Certificate Authority (CA) Providers
                        </label>
                        
                        <div class="space-y-4">
                            <!-- Default CA Selection -->
                            <div>
                                <label class="block text-xs font-medium text-gray-600 dark:text-gray-400 mb-2">
                                    Default Certificate Authority
                                </label>
                                <select id="default-ca" name="default_ca" 
                                        class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-primary focus:border-primary dark:bg-gray-700 dark:text-white text-sm"
                                        onchange="toggleCAProviderConfig()">
                                    <option value="letsencrypt">Let's Encrypt (Default)</option>
                                    <option value="digicert">DigiCert ACME</option>
                                    <option value="private_ca">Private CA</option>
                                </select>
                                <p class="text-xs text-gray-500 dark:text-gray-400 mt-1">
                                    Select the default CA for new certificate requests. You can override this per-certificate.
                                </p>
                            </div>

                            <!-- CA Provider Configurations -->
                            
                            <!-- Let's Encrypt Configuration -->
                            <div id="letsencrypt-config" class="border border-green-300 dark:border-green-600 rounded-lg p-4 bg-green-50 dark:bg-green-900/20">
                                <h4 class="text-sm font-semibold text-green-800 dark:text-green-200 mb-2 flex items-center">
                                    <i class="fas fa-leaf mr-2 text-green-600"></i>
                                    Let's Encrypt Configuration
                                    <span class="ml-2 text-xs bg-green-100 dark:bg-green-900/30 text-green-800 dark:text-green-300 px-2 py-0.5 rounded-full">Free</span>
                                </h4>
                                <div class="space-y-3">
                                    <div>
                                        <label class="block text-xs text-green-800 dark:text-green-200 mb-1">Environment</label>
                                        <select id="letsencrypt-environment" 
                                                class="w-full px-2 py-1 text-sm border border-green-300 dark:border-green-600 rounded bg-white dark:bg-gray-800 text-gray-900 dark:text-white">
                                            <option value="production">Production (Default)</option>
                                            <option value="staging">Staging (Testing)</option>
                                        </select>
                                    </div>
                                    <div>
                                        <label class="block text-xs text-green-800 dark:text-green-200 mb-1">Email (for notifications)</label>
                                        <input type="email" id="letsencrypt-email" 
                                               class="w-full px-2 py-1 text-sm border border-green-300 dark:border-green-600 rounded bg-white dark:bg-gray-800 text-gray-900 dark:text-white"
                                               placeholder="admin@example.com">
                                    </div>
                                </div>
                                <p class="text-xs text-green-700 dark:text-green-300 mt-2">
                                    Let's Encrypt provides free SSL certificates with automated renewal.
                                </p>
                            </div>

                            <!-- DigiCert Configuration -->
                            <div id="digicert-config" class="border border-blue-300 dark:border-blue-600 rounded-lg p-4 bg-blue-50 dark:bg-blue-900/20" style="display: none;">
                                <h4 class="text-sm font-semibold text-blue-800 dark:text-blue-200 mb-2 flex items-center">
                                    <i class="fas fa-shield-alt mr-2 text-blue-600"></i>
                                    DigiCert ACME Configuration
                                    <span class="ml-2 text-xs bg-blue-100 dark:bg-blue-900/30 text-blue-800 dark:text-blue-300 px-2 py-0.5 rounded-full">Enterprise</span>
                                </h4>
                                <div class="space-y-3">
                                    <div>
                                        <label class="block text-xs text-blue-800 dark:text-blue-200 mb-1">ACME Directory URL</label>
                                        <input type="url" id="digicert-acme-url" 
                                               class="w-full px-2 py-1 text-sm border border-blue-300 dark:border-blue-600 rounded bg-white dark:bg-gray-800 text-gray-900 dark:text-white"
                                               placeholder="https://acme.digicert.com/v2/acme/directory"
                                               value="https://acme.digicert.com/v2/acme/directory">
                                    </div>
                                    <div>
                                        <label class="block text-xs text-blue-800 dark:text-blue-200 mb-1">External Account Binding (EAB) Key ID</label>
                                        <input type="text" id="digicert-eab-kid" 
                                               class="w-full px-2 py-1 text-sm border border-blue-300 dark:border-blue-600 rounded bg-white dark:bg-gray-800 text-gray-900 dark:text-white"
                                               placeholder="Your EAB Key ID from DigiCert">
                                    </div>
                                    <div>
                                        <label class="block text-xs text-blue-800 dark:text-blue-200 mb-1">External Account Binding (EAB) HMAC Key</label>
                                        <input type="password" id="digicert-eab-hmac" 
                                               class="w-full px-2 py-1 text-sm border border-blue-300 dark:border-blue-600 rounded bg-white dark:bg-gray-800 text-gray-900 dark:text-white"
                                               placeholder="Your EAB HMAC Key from DigiCert"
                                               autocomplete="new-password" 
                                               spellcheck="false"
                                               data-lpignore="true">
                                    </div>
                                    <div>
                                        <label class="block text-xs text-blue-800 dark:text-blue-200 mb-1">Email (for notifications)</label>
                                        <input type="email" id="digicert-email" 
                                               class="w-full px-2 py-1 text-sm border border-blue-300 dark:border-blue-600 rounded bg-white dark:bg-gray-800 text-gray-900 dark:text-white"
                                               placeholder="admin@example.com">
                                    </div>
                                </div>
                                <p class="text-xs text-blue-700 dark:text-blue-300 mt-2">
                                    DigiCert provides enterprise-grade SSL certificates via ACME. Requires EAB credentials from DigiCert.
                                </p>
                            </div>

                            <!-- Private CA Configuration -->
                            <div id="private-ca-config" class="border border-purple-300 dark:border-purple-600 rounded-lg p-4 bg-purple-50 dark:bg-purple-900/20" style="display: none;">
                                <h4 class="text-sm font-semibold text-purple-800 dark:text-purple-200 mb-2 flex items-center">
                                    <i class="fas fa-building mr-2 text-purple-600"></i>
                                    Private CA Configuration
                                    <span class="ml-2 text-xs bg-purple-100 dark:bg-purple-900/30 text-purple-800 dark:text-purple-300 px-2 py-0.5 rounded-full">Custom</span>
                                </h4>
                                <div class="space-y-3">
                                    <div>
                                        <label class="block text-xs text-purple-800 dark:text-purple-200 mb-1">
                                            ACME Directory URL
                                            <span class="text-red-500">*</span>
                                            <i class="fas fa-info-circle ml-1 cursor-help" title="URL to your private CA's ACME directory endpoint (e.g., step-ca, Smallstep, or custom ACME server)"></i>
                                        </label>
                                        <input type="url" id="private-ca-acme-url" 
                                               class="w-full px-2 py-1 text-sm border-2 border-purple-300 dark:border-purple-600 rounded bg-white dark:bg-gray-800 text-gray-900 dark:text-white focus:border-purple-500 focus:ring-2 focus:ring-purple-200"
                                               placeholder="https://step-ca.example.com:9000/acme/directory"
                                               required>
                                        <p class="text-xs text-purple-600 dark:text-purple-400 mt-1">
                                            <strong>Common examples:</strong><br>
                                             step-ca: https://step-ca.internal.com:9000/acme/directory<br>
                                             Smallstep: https://ca.example.com/acme/directory<br>
                                             Boulder: https://boulder.local:4001/acme/directory
                                        </p>
                                    </div>
                                    <div>
                                        <label class="block text-xs text-purple-800 dark:text-purple-200 mb-1">CA Certificate (PEM format) - Optional</label>
                                        <textarea id="private-ca-cert" rows="3"
                                                  class="w-full px-2 py-1 text-sm border border-purple-300 dark:border-purple-600 rounded bg-white dark:bg-gray-800 text-gray-900 dark:text-white"
                                                  placeholder="-----BEGIN CERTIFICATE-----&#10;...&#10;-----END CERTIFICATE-----"></textarea>
                                        <p class="text-xs text-purple-600 dark:text-purple-400 mt-1">
                                            Upload your private CA root certificate if using self-signed or internal CA
                                        </p>
                                    </div>
                                    <div>
                                        <label class="block text-xs text-purple-800 dark:text-purple-200 mb-1">External Account Binding (EAB) Key ID - Optional</label>
                                        <input type="text" id="private-ca-eab-kid" 
                                               class="w-full px-2 py-1 text-sm border border-purple-300 dark:border-purple-600 rounded bg-white dark:bg-gray-800 text-gray-900 dark:text-white"
                                               placeholder="EAB Key ID (if required by your CA)">
                                    </div>
                                    <div>
                                        <label class="block text-xs text-purple-800 dark:text-purple-200 mb-1">External Account Binding (EAB) HMAC Key - Optional</label>
                                        <input type="password" id="private-ca-eab-hmac" 
                                               class="w-full px-2 py-1 text-sm border border-purple-300 dark:border-purple-600 rounded bg-white dark:bg-gray-800 text-gray-900 dark:text-white"
                                               placeholder="EAB HMAC Key (if required by your CA)"
                                               autocomplete="new-password" 
                                               spellcheck="false"
                                               data-lpignore="true">
                                    </div>
                                    <div>
                                        <label class="block text-xs text-purple-800 dark:text-purple-200 mb-1">
                                            Email (for notifications)
                                            <span class="text-red-500">*</span>
                                        </label>
                                        <input type="email" id="private-ca-email" 
                                               class="w-full px-2 py-1 text-sm border border-purple-300 dark:border-purple-600 rounded bg-white dark:bg-gray-800 text-gray-900 dark:text-white"
                                               placeholder="admin@example.com"
                                               required>
                                    </div>
                                </div>
                                <p class="text-xs text-purple-700 dark:text-purple-300 mt-2">
                                    Configure your private or corporate CA. Supports ACME-compatible CAs like step-ca, Smallstep, Boulder, and others.
                                    <br><strong> Quick Start:</strong>
                                    <br>1. Enter your CA's ACME directory URL above
                                    <br>2. Enter your email address
                                    <br>3. Click "Test CA Connection" to verify
                                    <br>4. Save settings once test succeeds
                                </p>
                            </div>

                            <!-- CA Provider Actions -->
                            <div class="flex flex-wrap gap-3 pt-2 border-t border-gray-200 dark:border-gray-600">
                                <button type="button" onclick="testCAProvider()" 
                                        class="bg-green-600 text-white px-4 py-2 rounded-md hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-green-500 focus:ring-offset-2 transition-colors text-sm font-medium">
                                    <i class="fas fa-plug mr-1"></i> Test CA Connection
                                </button>
                                <div class="text-xs text-gray-500 dark:text-gray-400 flex items-center">
                                    <i class="fas fa-info-circle mr-1"></i>
                                    <span id="ca-test-hint">Select a CA provider and fill in required fields, then test the connection</span>
                                </div>
                            </div>
                        </div>
                    </div>
                    </div><!-- /tab: ca -->

                    <!-- TAB: General Settings -->
                    <div x-show="tab === 'general'" x-cloak
                    <!-- General Certificate Settings Section -->
                    <div class="bg-gray-50 dark:bg-gray-700/50 p-4 rounded-lg">
                        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-3">
                            <i class="fas fa-cogs mr-1"></i>
                            Certificate Management Settings
                        </label>
                        
                        <div class="space-y-4">
                            <!-- Auto Renewal Setting -->
                            <div>
                                <label class="flex items-center">
                                    <input type="checkbox" id="auto_renew" name="auto_renew" 
                                           class="rounded border-gray-300 dark:border-gray-600 text-primary focus:ring-primary focus:ring-offset-0 dark:bg-gray-700">
                                    <span class="ml-2 text-sm text-gray-700 dark:text-gray-300">Enable automatic certificate renewal</span>
                                </label>
                                <p class="mt-1 text-xs text-gray-500 dark:text-gray-400">
                                    Automatically renew certificates when they approach expiration
                                </p>
                            </div>
                            
                            <!-- Renewal Threshold Setting -->
                            <div>
                                <label class="block text-xs font-medium text-gray-600 dark:text-gray-400 mb-2">
                                    Certificate Renewal Threshold (days)
                                </label>
                                <input type="number" id="renewal_threshold_days" name="renewal_threshold_days" 
                                       min="1" max="90" value="30"
                                       class="w-32 px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-primary focus:border-primary dark:bg-gray-700 dark:text-white text-sm">
                                <p class="mt-1 text-xs text-gray-500 dark:text-gray-400">
                                    Renew certificates when they have this many days left before expiration (default: 30 days)
                                </p>
                            </div>

                            <!-- Cache TTL Setting -->
                            <div>
                                <label class="block text-xs font-medium text-gray-600 dark:text-gray-400 mb-2">
                                    Cache TTL (seconds)
                                </label>
                                <input type="number" id="cache_ttl" name="cache_ttl" 
                                       min="0" max="86400" value="300"
                                       class="w-32 px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-primary focus:border-primary dark:bg-gray-700 dark:text-white text-sm">
                                <p class="mt-1 text-xs text-gray-500 dark:text-gray-400">
                                    How long to cache DNS responses (default: 300 seconds)
                                </p>
                            </div>
                        </div>
                    </div>

                    <!-- API Security Settings Section -->
                    <div class="bg-gray-50 dark:bg-gray-700/50 p-4 rounded-lg">
                        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-3">
                            <i class="fas fa-key mr-1"></i>
                            API Security Settings
                        </label>
                        
                        <div class="space-y-4">
                            <!-- API Bearer Token Setting -->
                            <div>
                                <label class="block text-xs font-medium text-gray-600 dark:text-gray-400 mb-2">
                                    API Bearer Token
                                </label>
                                <div class="flex items-center space-x-2">
                                    <input type="password" id="api_bearer_token" name="api_bearer_token" 
                                           placeholder="Enter a secure token for API authentication"
                                           class="flex-1 px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-primary focus:border-primary dark:bg-gray-700 dark:text-white text-sm">
                                    <button type="button" onclick="toggleTokenVisibility()" 
                                            class="px-3 py-2 text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200">
                                        <i class="fas fa-eye" id="tokenToggleIcon"></i>
                                    </button>
                                    <button type="button" onclick="generateToken()" 
                                            class="px-3 py-2 bg-gray-100 dark:bg-gray-600 text-gray-700 dark:text-gray-200 rounded-md hover:bg-gray-200 dark:hover:bg-gray-500 text-sm">
                                        <i class="fas fa-random mr-1"></i> Generate
                                    </button>
                                </div>
                                <p class="mt-1 text-xs text-gray-500 dark:text-gray-400">
                                    Token used for API authentication. Required for API access after initial setup.
                                </p>
                            </div>
                        </div>
                    </div>
                    </div><!-- /tab: general -->

                    <!-- TAB: Storage -->
                    <div x-show="tab === 'storage'" x-cloak
                    <!-- Certificate Storage Backend Section -->
                    <div class="bg-gray-50 dark:bg-gray-700/50 p-4 rounded-lg">
                        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-3">
                            <i class="fas fa-database mr-1"></i>
                            Certificate Storage Backend
                        </label>
                        
                        <div class="space-y-4">
                            <!-- Backend Selection -->
                            <div>
                                <label class="block text-xs font-medium text-gray-600 dark:text-gray-400 mb-2">
                                    Storage Backend Type
                                </label>
                                <select id="storage-backend" name="storage_backend" 
                                        class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-primary focus:border-primary dark:bg-gray-700 dark:text-white text-sm"
                                        onchange="toggleStorageBackendConfig()">
                                    <option value="local_filesystem">Local Filesystem (Default)</option>
                                    <option value="azure_keyvault">Azure Key Vault</option>
                                    <option value="aws_secrets_manager">AWS Secrets Manager</option>
                                    <option value="hashicorp_vault">HashiCorp Vault</option>
                                    <option value="infisical">Infisical</option>
                                </select>
                                <p class="mt-1 text-xs text-gray-500 dark:text-gray-400">
                                    Choose where to store your SSL certificates. Local filesystem is the default and most compatible option.
                                </p>
                            </div>

                            <!-- Local Filesystem Configuration -->
                            <div id="storage-local-config" class="storage-config">
                                <div class="bg-blue-50 dark:bg-blue-900/20 p-3 rounded-md border border-blue-200 dark:border-blue-700">
                                    <h5 class="text-sm font-medium text-blue-900 dark:text-blue-100 mb-2">
                                        <i class="fas fa-folder mr-1"></i> Local Filesystem Storage
                                    </h5>
                                    <div class="space-y-2">
                                        <div>
                                            <label class="block text-xs text-blue-800 dark:text-blue-200 mb-1">Certificate Directory</label>
                                            <input type="text" id="storage-cert-dir" 
                                                   class="w-full px-2 py-1 text-sm border border-blue-300 dark:border-blue-600 rounded bg-white dark:bg-gray-800 text-gray-900 dark:text-white"
                                                   placeholder="certificates" value="certificates">
                                        </div>
                                        <p class="text-xs text-blue-700 dark:text-blue-300">
                                            Certificates are stored locally in the specified directory with secure file permissions.
                                        </p>
                                    </div>
                                </div>
                            </div>

                            <!-- Azure Key Vault Configuration -->
                            <div id="storage-azure-config" class="storage-config" style="display: none;">
                                <div class="bg-blue-50 dark:bg-blue-900/20 p-3 rounded-md border border-blue-200 dark:border-blue-700">
                                    <h5 class="text-sm font-medium text-blue-900 dark:text-blue-100 mb-2">
                                        <i class="fab fa-microsoft mr-1"></i> Azure Key Vault Configuration
                                    </h5>
                                    <div class="grid grid-cols-1 md:grid-cols-2 gap-3">
                                        <div>
                                            <label class="block text-xs text-blue-800 dark:text-blue-200 mb-1">Vault URL</label>
                                            <input type="text" id="azure-vault-url" 
                                                   class="w-full px-2 py-1 text-sm border border-blue-300 dark:border-blue-600 rounded bg-white dark:bg-gray-800 text-gray-900 dark:text-white"
                                                   placeholder="https://yourvault.vault.azure.net/">
                                        </div>
                                        <div>
                                            <label class="block text-xs text-blue-800 dark:text-blue-200 mb-1">Tenant ID</label>
                                            <input type="text" id="azure-tenant-id" 
                                                   class="w-full px-2 py-1 text-sm border border-blue-300 dark:border-blue-600 rounded bg-white dark:bg-gray-800 text-gray-900 dark:text-white"
                                                   placeholder="xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx">
                                        </div>
                                        <div>
                                            <label class="block text-xs text-blue-800 dark:text-blue-200 mb-1">Client ID</label>
                                            <input type="text" id="azure-client-id" 
                                                   class="w-full px-2 py-1 text-sm border border-blue-300 dark:border-blue-600 rounded bg-white dark:bg-gray-800 text-gray-900 dark:text-white"
                                                   placeholder="xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx">
                                        </div>
                                        <div>
                                            <label class="block text-xs text-blue-800 dark:text-blue-200 mb-1">Client Secret</label>
                                            <input type="password" id="azure-client-secret" 
                                                   class="w-full px-2 py-1 text-sm border border-blue-300 dark:border-blue-600 rounded bg-white dark:bg-gray-800 text-gray-900 dark:text-white"
                                                   placeholder="Enter client secret"
                                                   autocomplete="new-password" 
                                                   spellcheck="false"
                                                   data-lpignore="true">
                                        </div>
                                    </div>
                                    <p class="text-xs text-blue-700 dark:text-blue-300 mt-2">
                                        Certificates will be stored as secrets in Azure Key Vault with enhanced security and audit capabilities.
                                    </p>
                                </div>
                            </div>

                            <!-- AWS Secrets Manager Configuration -->
                            <div id="storage-aws-config" class="storage-config" style="display: none;">
                                <div class="bg-orange-50 dark:bg-orange-900/20 p-3 rounded-md border border-orange-200 dark:border-orange-700">
                                    <h5 class="text-sm font-medium text-orange-900 dark:text-orange-100 mb-2">
                                        <i class="fab fa-aws mr-1"></i> AWS Secrets Manager Configuration
                                    </h5>
                                    <div class="grid grid-cols-1 md:grid-cols-3 gap-3">
                                        <div>
                                            <label class="block text-xs text-orange-800 dark:text-orange-200 mb-1">Region</label>
                                            <input type="text" id="aws-region" 
                                                   class="w-full px-2 py-1 text-sm border border-orange-300 dark:border-orange-600 rounded bg-white dark:bg-gray-800 text-gray-900 dark:text-white"
                                                   placeholder="us-east-1" value="us-east-1">
                                        </div>
                                        <div>
                                            <label class="block text-xs text-orange-800 dark:text-orange-200 mb-1">Access Key ID</label>
                                            <input type="text" id="aws-access-key-id" 
                                                   class="w-full px-2 py-1 text-sm border border-orange-300 dark:border-orange-600 rounded bg-white dark:bg-gray-800 text-gray-900 dark:text-white"
                                                   placeholder="AKIAIOSFODNN7EXAMPLE">
                                        </div>
                                        <div>
                                            <label class="block text-xs text-orange-800 dark:text-orange-200 mb-1">Secret Access Key</label>
                                            <input type="password" id="aws-secret-access-key" 
                                                   class="w-full px-2 py-1 text-sm border border-orange-300 dark:border-orange-600 rounded bg-white dark:bg-gray-800 text-gray-900 dark:text-white"
                                                   placeholder="Enter secret access key"
                                                   autocomplete="new-password" 
                                                   spellcheck="false"
                                                   data-lpignore="true">
                                        </div>
                                    </div>
                                    <p class="text-xs text-orange-700 dark:text-orange-300 mt-2">
                                        Certificates will be stored in AWS Secrets Manager with automatic encryption and access logging.
                                    </p>
                                </div>
                            </div>

                            <!-- HashiCorp Vault Configuration -->
                            <div id="storage-vault-config" class="storage-config" style="display: none;">
                                <div class="bg-purple-50 dark:bg-purple-900/20 p-3 rounded-md border border-purple-200 dark:border-purple-700">
                                    <h5 class="text-sm font-medium text-purple-900 dark:text-purple-100 mb-2">
                                        <i class="fas fa-vault mr-1"></i> HashiCorp Vault Configuration
                                    </h5>
                                    <div class="grid grid-cols-1 md:grid-cols-2 gap-3">
                                        <div>
                                            <label class="block text-xs text-purple-800 dark:text-purple-200 mb-1">Vault URL</label>
                                            <input type="text" id="vault-url" 
                                                   class="w-full px-2 py-1 text-sm border border-purple-300 dark:border-purple-600 rounded bg-white dark:bg-gray-800 text-gray-900 dark:text-white"
                                                   placeholder="https://vault.example.com:8200">
                                        </div>
                                        <div>
                                            <label class="block text-xs text-purple-800 dark:text-purple-200 mb-1">Vault Token</label>
                                            <input type="password" id="vault-token" 
                                                   class="w-full px-2 py-1 text-sm border border-purple-300 dark:border-purple-600 rounded bg-white dark:bg-gray-800 text-gray-900 dark:text-white"
                                                   placeholder="Enter vault token"
                                                   autocomplete="new-password" 
                                                   spellcheck="false"
                                                   data-lpignore="true">
                                        </div>
                                        <div>
                                            <label class="block text-xs text-purple-800 dark:text-purple-200 mb-1">Mount Point</label>
                                            <input type="text" id="vault-mount-point" 
                                                   class="w-full px-2 py-1 text-sm border border-purple-300 dark:border-purple-600 rounded bg-white dark:bg-gray-800 text-gray-900 dark:text-white"
                                                   placeholder="secret" value="secret">
                                        </div>
                                        <div>
                                            <label class="block text-xs text-purple-800 dark:text-purple-200 mb-1">Engine Version</label>
                                            <select id="vault-engine-version" 
                                                    class="w-full px-2 py-1 text-sm border border-purple-300 dark:border-purple-600 rounded bg-white dark:bg-gray-800 text-gray-900 dark:text-white">
                                                <option value="v2">KV v2</option>
                                                <option value="v1">KV v1</option>
                                            </select>
                                        </div>
                                    </div>
                                    <p class="text-xs text-purple-700 dark:text-purple-300 mt-2">
                                        Certificates will be stored in HashiCorp Vault's KV secrets engine with versioning and audit capabilities.
                                    </p>
                                </div>
                            </div>

                            <!-- Infisical Configuration -->
                            <div id="storage-infisical-config" class="storage-config" style="display: none;">
                                <div class="bg-green-50 dark:bg-green-900/20 p-3 rounded-md border border-green-200 dark:border-green-700">
                                    <h5 class="text-sm font-medium text-green-900 dark:text-green-100 mb-2">
                                        <i class="fas fa-shield-alt mr-1"></i> Infisical Configuration
                                    </h5>
                                    <div class="grid grid-cols-1 md:grid-cols-2 gap-3">
                                        <div>
                                            <label class="block text-xs text-green-800 dark:text-green-200 mb-1">Site URL</label>
                                            <input type="text" id="infisical-site-url" 
                                                   class="w-full px-2 py-1 text-sm border border-green-300 dark:border-green-600 rounded bg-white dark:bg-gray-800 text-gray-900 dark:text-white"
                                                   placeholder="https://app.infisical.com" value="https://app.infisical.com">
                                        </div>
                                        <div>
                                            <label class="block text-xs text-green-800 dark:text-green-200 mb-1">Project ID</label>
                                            <input type="text" id="infisical-project-id" 
                                                   class="w-full px-2 py-1 text-sm border border-green-300 dark:border-green-600 rounded bg-white dark:bg-gray-800 text-gray-900 dark:text-white"
                                                   placeholder="Enter project ID">
                                        </div>
                                        <div>
                                            <label class="block text-xs text-green-800 dark:text-green-200 mb-1">Client ID</label>
                                            <input type="text" id="infisical-client-id" 
                                                   class="w-full px-2 py-1 text-sm border border-green-300 dark:border-green-600 rounded bg-white dark:bg-gray-800 text-gray-900 dark:text-white"
                                                   placeholder="Enter client ID">
                                        </div>
                                        <div>
                                            <label class="block text-xs text-green-800 dark:text-green-200 mb-1">Client Secret</label>
                                            <input type="password" id="infisical-client-secret" 
                                                   class="w-full px-2 py-1 text-sm border border-green-300 dark:border-green-600 rounded bg-white dark:bg-gray-800 text-gray-900 dark:text-white"
                                                   placeholder="Enter client secret"
                                                   autocomplete="new-password" 
                                                   spellcheck="false"
                                                   data-lpignore="true">
                                        </div>
                                        <div>
                                            <label class="block text-xs text-green-800 dark:text-green-200 mb-1">Environment</label>
                                            <input type="text" id="infisical-environment" 
                                                   class="w-full px-2 py-1 text-sm border border-green-300 dark:border-green-600 rounded bg-white dark:bg-gray-800 text-gray-900 dark:text-white"
                                                   placeholder="prod" value="prod">
                                        </div>
                                    </div>
                                    <p class="text-xs text-green-700 dark:text-green-300 mt-2">
                                        Certificates will be stored in Infisical with end-to-end encryption and team collaboration features.
                                    </p>
                                </div>
                            </div>

                            <!-- Storage Backend Actions -->
                            <div class="flex flex-wrap gap-3 pt-2 border-t border-gray-200 dark:border-gray-600">
                                <button type="button" onclick="testStorageBackend()" 
                                        class="bg-blue-600 text-white px-3 py-2 rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 transition-colors text-sm">
                                    <i class="fas fa-plug mr-1"></i> Test Connection
                                </button>
                                <button type="button" onclick="showStorageMigrationModal()" 
                                        class="bg-yellow-600 text-white px-3 py-2 rounded-md hover:bg-yellow-700 focus:outline-none focus:ring-2 focus:ring-yellow-500 focus:ring-offset-2 transition-colors text-sm">
                                    <i class="fas fa-exchange-alt mr-1"></i> Migrate Certificates
                                </button>
                                <div class="text-xs text-gray-500 dark:text-gray-400 flex items-center">
                                    <i class="fas fa-info-circle mr-1"></i>
                                    Test connection before saving settings
                                </div>
                            </div>
                        </div>
                    </div>
                    </div><!-- /tab: storage -->

                    <!-- Form controls (visible on all form tabs) -->
                    <div id="formControls" x-show="['dns','ca','general','storage'].includes(tab)"
                        <!-- DNS Provider Test Connection -->
                        <div id="testConnectionResult" class="mt-4 hidden">
                            <div class="p-4 rounded-md text-sm" id="testConnectionMessage">
                                <!-- Test connection message will be displayed here -->
                            </div>
                        </div>

                        <!-- Submit Button -->
                        <div class="flex justify-end mt-6">
                            <button type="submit" id="saveBtn" class="bg-primary text-white px-6 py-2 rounded-md hover:bg-secondary focus:outline-none focus:ring-2 focus:ring-primary focus:ring-offset-2 dark:focus:ring-offset-gray-800 transition-colors">
                                <i class="fas fa-save mr-2"></i>
                                Save Settings
                            </button>
                        </div>
                    </div>
                </form>
            </div>
        </div>

        <!-- TAB: Notifications -->
        <div x-show="tab === 'notifications'" x-cloak class="bg-white dark:bg-gray-800 rounded-lg shadow-sm border border-gray-200 dark:border-gray-700 p-6 mt-6"
             x-data="notificationSettings()" x-init="loadConfig()">
            <h3 class="text-lg font-semibold text-gray-900 dark:text-white flex items-center mb-6">
                <i class="fas fa-bell mr-2 text-yellow-500"></i>
                Notification Settings
            </h3>

            <!-- Master toggle -->
            <div class="flex items-center justify-between p-4 bg-gray-50 dark:bg-gray-700/30 rounded-lg mb-6">
                <div>
                    <p class="font-medium text-gray-900 dark:text-white">Enable Notifications</p>
                    <p class="text-sm text-gray-500 dark:text-gray-400">Send alerts for certificate events</p>
                </div>
                <label class="relative inline-flex items-center cursor-pointer">
                    <input type="checkbox" x-model="config.enabled" class="sr-only peer" title="Enable notifications">
                    <div class="w-11 h-6 bg-gray-200 peer-focus:ring-2 peer-focus:ring-primary rounded-full peer dark:bg-gray-600 peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all dark:border-gray-500 peer-checked:bg-primary"></div>
                </label>
            </div>

            <div x-show="config.enabled" class="space-y-6">
                <!-- Event filter -->
                <div>
                    <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"><i class="fas fa-filter mr-1.5 text-blue-500"></i>Notify on Events</label>
                    <div class="flex flex-wrap gap-2">
                        <template x-for="evt in ['certificate_created','certificate_renewed','certificate_expiring','certificate_revoked','certificate_failed']">
                            <label class="inline-flex items-center px-3 py-1.5 rounded-full text-xs font-medium cursor-pointer border transition"
                                   :class="config.events.includes(evt) ? 'bg-primary/10 border-primary text-primary' : 'bg-gray-100 dark:bg-gray-700 border-gray-200 dark:border-gray-600 text-gray-600 dark:text-gray-300'">
                                <input type="checkbox" class="sr-only" :value="evt"
                                       :checked="config.events.includes(evt)"
                                       @change="toggleEvent(evt)">
                                <span x-text="evt.replace('certificate_','').replace('_',' ')"></span>
                            </label>
                        </template>
                    </div>
                </div>

                <!-- SMTP -->
                <div class="border border-gray-200 dark:border-gray-700 rounded-lg overflow-hidden">
                    <button type="button" @click="showSmtp = !showSmtp" class="w-full flex items-center justify-between px-4 py-3 bg-gray-50 dark:bg-gray-700/30 hover:bg-gray-100 dark:hover:bg-gray-700/50 transition">
                        <span class="font-medium text-gray-900 dark:text-white text-sm"><i class="fas fa-envelope mr-2 text-blue-500"></i>Email (SMTP)</span>
                        <div class="flex items-center gap-2">
                            <span x-show="config.channels.smtp.enabled" class="px-2 py-0.5 bg-green-100 dark:bg-green-900/30 text-green-700 dark:text-green-300 rounded text-xs">Active</span>
                            <i class="fas fa-chevron-down text-gray-400 transition" :class="showSmtp ? 'rotate-180' : ''"></i>
                        </div>
                    </button>
                    <div x-show="showSmtp" x-cloak class="p-4 space-y-3">
                        <label class="flex items-center gap-2">
                            <input type="checkbox" x-model="config.channels.smtp.enabled" class="w-4 h-4 rounded text-primary focus:ring-primary">
                            <span class="text-sm text-gray-700 dark:text-gray-300">Enable email notifications</span>
                        </label>
                        <div class="grid grid-cols-1 sm:grid-cols-2 gap-3">
                            <div><label class="block text-xs text-gray-500 mb-1">SMTP Host</label><input type="text" x-model="config.channels.smtp.host" placeholder="smtp.gmail.com" class="w-full px-3 py-2 text-sm border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white"></div>
                            <div><label class="block text-xs text-gray-500 mb-1">Port</label><input type="number" x-model.number="config.channels.smtp.port" placeholder="587" class="w-full px-3 py-2 text-sm border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white"></div>
                            <div><label class="block text-xs text-gray-500 mb-1">Username</label><input type="text" x-model="config.channels.smtp.username" placeholder="user@example.com" class="w-full px-3 py-2 text-sm border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white"></div>
                            <div><label class="block text-xs text-gray-500 mb-1">Password</label><input type="password" x-model="config.channels.smtp.password" placeholder="App password" class="w-full px-3 py-2 text-sm border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white"></div>
                            <div><label class="block text-xs text-gray-500 mb-1">From Address</label><input type="email" x-model="config.channels.smtp.from_address" placeholder="certmate@example.com" class="w-full px-3 py-2 text-sm border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white"></div>
                            <div><label class="block text-xs text-gray-500 mb-1">To Addresses (comma-separated)</label><input type="text" x-model="smtpToStr" placeholder="admin@example.com" class="w-full px-3 py-2 text-sm border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white"></div>
                        </div>
                        <button type="button" @click="testSmtp()" class="text-sm text-blue-600 dark:text-blue-400 hover:underline"><i class="fas fa-paper-plane mr-1"></i>Send test email</button>
                    </div>
                </div>

                <!-- Webhooks -->
                <div class="border border-gray-200 dark:border-gray-700 rounded-lg overflow-hidden">
                    <button type="button" @click="showWebhooks = !showWebhooks" class="w-full flex items-center justify-between px-4 py-3 bg-gray-50 dark:bg-gray-700/30 hover:bg-gray-100 dark:hover:bg-gray-700/50 transition">
                        <span class="font-medium text-gray-900 dark:text-white text-sm"><i class="fas fa-plug mr-2 text-purple-500"></i>Webhooks</span>
                        <div class="flex items-center gap-2">
                            <span x-show="config.channels.webhooks.filter(w=>w.enabled).length > 0" class="px-2 py-0.5 bg-green-100 dark:bg-green-900/30 text-green-700 dark:text-green-300 rounded text-xs" x-text="config.channels.webhooks.filter(w=>w.enabled).length + ' active'"></span>
                            <i class="fas fa-chevron-down text-gray-400 transition" :class="showWebhooks ? 'rotate-180' : ''"></i>
                        </div>
                    </button>
                    <div x-show="showWebhooks" x-cloak class="p-4 space-y-4">
                        <template x-for="(wh, idx) in config.channels.webhooks" :key="idx">
                            <div class="border border-gray-200 dark:border-gray-600 rounded-lg p-3 space-y-2">
                                <div class="flex items-center justify-between">
                                    <div class="flex items-center gap-2">
                                        <input type="checkbox" x-model="wh.enabled" class="w-4 h-4 rounded text-primary focus:ring-primary">
                                        <input type="text" x-model="wh.name" placeholder="Webhook name" class="text-sm font-medium bg-transparent border-none p-0 text-gray-900 dark:text-white focus:ring-0 w-32">
                                    </div>
                                    <button type="button" @click="config.channels.webhooks.splice(idx, 1)" class="text-red-400 hover:text-red-600 text-sm"><i class="fas fa-trash"></i></button>
                                </div>
                                <div class="grid grid-cols-1 sm:grid-cols-2 gap-2">
                                    <div class="sm:col-span-2"><input type="url" x-model="wh.url" placeholder="https://hooks.slack.com/..." class="w-full px-3 py-2 text-sm border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white"></div>
                                    <div>
                                        <select x-model="wh.type" class="w-full px-3 py-2 text-sm border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white">
                                            <option value="generic">Generic</option>
                                            <option value="slack">Slack</option>
                                            <option value="discord">Discord</option>
                                        </select>
                                    </div>
                                    <div><input type="text" x-model="wh.secret" placeholder="HMAC secret (optional)" class="w-full px-3 py-2 text-sm border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white"></div>
                                </div>
                                <button type="button" @click="testWebhook(wh)" class="text-sm text-blue-600 dark:text-blue-400 hover:underline"><i class="fas fa-paper-plane mr-1"></i>Test</button>
                            </div>
                        </template>
                        <button type="button" @click="config.channels.webhooks.push({enabled:true,name:'',url:'',type:'generic',secret:''})" class="text-sm text-primary hover:underline"><i class="fas fa-plus mr-1"></i>Add webhook</button>
                    </div>
                </div>
            </div>

            <!-- Save -->
            <div class="mt-6 flex justify-end">
                <button type="button" @click="saveConfig()" class="bg-primary text-white px-6 py-2 rounded-md hover:bg-secondary transition text-sm">
                    <i class="fas fa-save mr-2"></i>Save Notification Settings
                </button>
            </div>
        </div>


        <!-- TAB: User Management Section -->
        <div x-show="tab === 'users'" x-cloak class="bg-white dark:bg-gray-800 rounded-lg shadow-sm border border-gray-200 dark:border-gray-700 p-6 mt-6"
            <div class="flex items-center justify-between mb-4">
                <h3 class="text-lg font-semibold text-gray-900 dark:text-white flex items-center">
                    <i class="fas fa-users mr-2 text-purple-500"></i>
                    User Management
                </h3>
                <span class="text-xs bg-purple-100 dark:bg-purple-900/30 text-purple-800 dark:text-purple-300 px-2 py-1 rounded-full">
                    Local Authentication
                </span>
            </div>
            
            <p class="text-gray-600 dark:text-gray-400 text-sm mb-6">
                Manage local user accounts for CertMate. Enable local authentication to require username/password login.
            </p>

            <!-- Security reminder (shown when auth is disabled) -->
            <div id="authSecurityBanner" class="mb-6 p-4 bg-amber-50 dark:bg-amber-900/20 border border-amber-200 dark:border-amber-800 rounded-lg" style="display: none;">
                <div class="flex items-start">
                    <i class="fas fa-exclamation-triangle text-amber-500 mt-0.5 mr-3 flex-shrink-0"></i>
                    <div>
                        <h4 class="text-sm font-medium text-amber-800 dark:text-amber-200">Authentication is disabled</h4>
                        <p class="text-xs text-amber-700 dark:text-amber-300 mt-1">
                            Anyone with network access can manage certificates and settings. Enable Local Authentication below and create an admin user to secure your instance.
                        </p>
                    </div>
                </div>
            </div>

            <!-- Local Auth Toggle -->
            <div class="mb-6 p-4 bg-gray-50 dark:bg-gray-700/50 rounded-lg">
                <div class="flex items-center justify-between">
                    <div>
                        <label class="text-sm font-medium text-gray-700 dark:text-gray-300">Enable Local Authentication</label>
                        <p class="text-xs text-gray-500 dark:text-gray-400 mt-1">Require username/password login for web access</p>
                    </div>
                    <label class="relative inline-flex items-center cursor-pointer">
                        <input type="checkbox" id="localAuthToggle" class="sr-only peer" onchange="toggleLocalAuth()">
                        <div class="w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 dark:peer-focus:ring-blue-800 rounded-full peer dark:bg-gray-600 peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all dark:border-gray-600 peer-checked:bg-blue-600"></div>
                    </label>
                </div>
            </div>

            <!-- Add User Form -->
            <div class="mb-6">
                <h4 class="text-sm font-semibold text-gray-700 dark:text-gray-300 mb-3">
                    <i class="fas fa-user-plus mr-1"></i> Add New User
                </h4>
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
                    <div>
                        <label class="block text-xs text-gray-600 dark:text-gray-400 mb-1">Username</label>
                        <input type="text" id="newUserUsername" placeholder="username"
                               class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md text-sm dark:bg-gray-700 dark:text-white">
                    </div>
                    <div>
                        <label class="block text-xs text-gray-600 dark:text-gray-400 mb-1">Password</label>
                        <input type="password" id="newUserPassword" placeholder="password"
                               class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md text-sm dark:bg-gray-700 dark:text-white">
                    </div>
                    <div>
                        <label class="block text-xs text-gray-600 dark:text-gray-400 mb-1">Email (optional)</label>
                        <input type="email" id="newUserEmail" placeholder="user@example.com"
                               class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md text-sm dark:bg-gray-700 dark:text-white">
                    </div>
                    <div>
                        <label class="block text-xs text-gray-600 dark:text-gray-400 mb-1">Role</label>
                        <div class="flex items-center space-x-2">
                            <select id="newUserRole" 
                                    class="flex-1 px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md text-sm dark:bg-gray-700 dark:text-white">
                                <option value="user">User</option>
                                <option value="admin">Admin</option>
                            </select>
                            <button type="button" onclick="createUser()" 
                                    class="px-4 py-2 bg-purple-600 text-white rounded-md hover:bg-purple-700 text-sm">
                                <i class="fas fa-plus mr-1"></i> Add
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- User List -->
            <div>
                <div class="flex items-center justify-between mb-3">
                    <h4 class="text-sm font-semibold text-gray-700 dark:text-gray-300">
                        <i class="fas fa-list mr-1"></i> Existing Users
                    </h4>
                    <button type="button" onclick="refreshUserList()" 
                            class="text-sm text-blue-600 dark:text-blue-400 hover:underline">
                        <i class="fas fa-sync-alt mr-1"></i> Refresh
                    </button>
                </div>
                <div id="userList" class="space-y-2 max-h-64 overflow-y-auto">
                    <div class="text-center py-4 text-gray-500 dark:text-gray-400 text-sm">
                        <i class="fas fa-spinner fa-spin mr-2"></i> Loading users...
                    </div>
                </div>
            </div>
        </div>

        <!-- TAB: Backup & Restore Section -->
        <div x-show="tab === 'backup'" x-cloak class="bg-white dark:bg-gray-800 rounded-lg shadow-sm border border-gray-200 dark:border-gray-700 p-6 mt-6"
            <div class="flex items-center justify-between mb-4">
                <h3 class="text-lg font-semibold text-gray-900 dark:text-white flex items-center">
                    <i class="fas fa-database mr-2 text-blue-500"></i>
                    Backup & Restore
                </h3>
                <span class="text-xs bg-blue-100 dark:bg-blue-900/30 text-blue-800 dark:text-blue-300 px-2 py-1 rounded-full">
                    Data Protection
                </span>
            </div>
            
            <p class="text-gray-600 dark:text-gray-400 text-sm mb-6">
                Create backups of your settings and certificates to prevent data loss. Restore from previous backups when needed.
            </p>

            <!-- Create Backup Section -->
            <div class="grid md:grid-cols-2 gap-6 mb-6">
                <div class="bg-gray-50 dark:bg-gray-700/50 rounded-lg p-4">
                    <h4 class="font-medium text-gray-900 dark:text-white mb-3 flex items-center">
                        <i class="fas fa-plus-circle mr-2 text-green-500"></i>
                        Create Backup
                    </h4>
                    <p class="text-sm text-gray-600 dark:text-gray-400 mb-4">
                        Create atomic backups that include both settings and certificates to ensure data consistency.
                    </p>
                    <div class="space-y-3">
                        <button type="button" onclick="createBackup('unified', this)" 
                                class="w-full bg-green-600 text-white px-4 py-2 rounded-md hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-green-500 focus:ring-offset-2 transition-colors text-sm">
                            <i class="fas fa-archive mr-2"></i>
                            Create Unified Backup (Recommended)
                        </button>
                    </div>
                </div>

                <div class="bg-gray-50 dark:bg-gray-700/50 rounded-lg p-4">
                    <h4 class="font-medium text-gray-900 dark:text-white mb-3 flex items-center">
                        <i class="fas fa-info-circle mr-2 text-blue-500"></i>
                        Backup Information
                    </h4>
                    <div class="space-y-2 text-sm text-gray-600 dark:text-gray-400">
                        <div class="flex items-start">
                            <i class="fas fa-check text-green-500 mr-2 mt-0.5 text-xs"></i>
                            <span><strong>Unified Backup:</strong> Atomic backup of both settings and certificates ensuring data consistency and preventing configuration mismatches</span>
                        </div>
                        <div class="flex items-start mt-3 pt-2 border-t border-gray-200 dark:border-gray-600">
                            <i class="fas fa-shield-alt text-yellow-500 mr-2 mt-0.5 text-xs"></i>
                            <span class="text-xs">Backups contain sensitive data. Keep them secure and stored safely.</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Existing Backups Section -->
            <div class="border-t border-gray-200 dark:border-gray-600 pt-6">
                <div class="flex items-center justify-between mb-4">
                    <h4 class="font-medium text-gray-900 dark:text-white flex items-center">
                        <i class="fas fa-history mr-2 text-orange-500"></i>
                        Existing Backups
                    </h4>
                    <button type="button" onclick="refreshBackupList()" 
                            class="text-sm text-blue-600 dark:text-blue-400 hover:text-blue-800 dark:hover:text-blue-300">
                        <i class="fas fa-sync-alt mr-1"></i>
                        Refresh
                    </button>
                </div>

                <!-- Backup Lists -->
                <div class="space-y-6">
                    <!-- Unified Backups (Recommended) -->
                    <div>
                        <h5 class="text-sm font-medium text-gray-700 dark:text-gray-300 mb-3">
                            <i class="fas fa-archive mr-1 text-green-500"></i>
                            Unified Backups (Recommended)
                            <span class="text-xs bg-green-100 dark:bg-green-900/30 text-green-800 dark:text-green-300 px-2 py-1 rounded-full ml-2">Atomic</span>
                        </h5>
                        <div id="unified-backup-list" class="space-y-2 max-h-64 overflow-y-auto">
                            <div class="text-sm text-gray-500 dark:text-gray-400 text-center py-4">
                                Loading unified backups...
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Status Messages -->
        <div id="statusMessage" class="mt-4 hidden"></div>
    </div>

    <!-- Add Account Modal -->
    <div id="addAccountModal" class="fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-50 hidden">
        <div class="relative top-20 mx-auto p-5 border w-96 shadow-lg rounded-md bg-white dark:bg-gray-800">
            <div class="mt-3">
                <div class="flex items-center justify-between mb-4">
                    <h3 class="text-lg font-medium text-gray-900 dark:text-white" id="modal-title">
                        Add Account
                    </h3>
                    <button type="button" onclick="closeAddAccountModal()" class="text-gray-400 hover:text-gray-600 dark:hover:text-gray-300">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                <form id="addAccountForm" class="space-y-4">
                    <div>
                        <label for="account-name" class="block text-sm font-medium text-gray-700 dark:text-gray-300">
                            Account Name *
                        </label>
                        <input type="text" id="account-name" name="name" required
                               class="mt-1 block w-full border border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-primary focus:border-primary"
                               placeholder="e.g., Production, Development, Client-A">
                    </div>
                    
                    <div>
                        <label for="account-description" class="block text-sm font-medium text-gray-700 dark:text-gray-300">
                            Description (optional)
                        </label>
                        <input type="text" id="account-description" name="description"
                               class="mt-1 block w-full border border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-primary focus:border-primary"
                               placeholder="Brief description of this account">
                    </div>
                    
                    <!-- Dynamic fields will be populated here based on provider -->
                    <div id="modal-provider-fields"></div>
                    
                    <div class="flex items-center">
                        <input type="checkbox" id="set-as-default" name="set_as_default" 
                               class="h-4 w-4 text-primary focus:ring-primary border-gray-300 rounded">
                        <label for="set-as-default" class="ml-2 block text-sm text-gray-700 dark:text-gray-300">
                            Set as default account
                        </label>
                    </div>
                    
                    <div class="flex justify-end space-x-3 pt-4">
                        <button type="button" onclick="closeAddAccountModal()" 
                                class="px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-md text-gray-700 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-700">
                            Cancel
                        </button>
                        <button type="button" onclick="saveAccount()" 
                                class="px-4 py-2 bg-primary text-white rounded-md hover:bg-secondary focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary">
                            Add Account
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Edit Account Modal -->
    <div id="editAccountModal" class="fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-50 hidden">
        <div class="relative top-20 mx-auto p-5 border w-96 shadow-lg rounded-md bg-white dark:bg-gray-800">
            <div class="mt-3">
                <div class="flex items-center justify-between mb-4">
                    <h3 class="text-lg font-medium text-gray-900 dark:text-white">
                        Edit Account
                    </h3>
                    <button type="button" onclick="closeEditAccountModal()" class="text-gray-400 hover:text-gray-600 dark:hover:text-gray-300">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                <form id="editAccountForm" class="space-y-4">
                    <input type="hidden" id="edit-account-id" name="edit-account-id">
                    <input type="hidden" id="edit-provider-name" name="edit-provider-name">
                    
                    <div>
                        <label for="edit-account-name" class="block text-sm font-medium text-gray-700 dark:text-gray-300">
                            Account Name *
                        </label>
                        <input type="text" id="edit-account-name" name="name" required
                               class="mt-1 block w-full border border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-primary focus:border-primary">
                    </div>
                    
                    <div>
                        <label for="edit-account-description" class="block text-sm font-medium text-gray-700 dark:text-gray-300">
                            Description (optional)
                        </label>
                        <input type="text" id="edit-account-description" name="description"
                               class="mt-1 block w-full border border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-primary focus:border-primary">
                    </div>
                    
                    <!-- Dynamic fields will be populated here based on provider -->
                    <div id="edit-modal-provider-fields"></div>
                    
                    <div class="flex items-center">
                        <input type="checkbox" id="edit-set-as-default" name="set_as_default" 
                               class="h-4 w-4 text-primary focus:ring-primary border-gray-300 rounded">
                        <label for="edit-set-as-default" class="ml-2 block text-sm text-gray-700 dark:text-gray-300">
                            Set as default account
                        </label>
                    </div>
                    
                    <div class="flex justify-end space-x-3 pt-4">
                        <button type="button" onclick="closeEditAccountModal()" 
                                class="px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-md text-gray-700 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-700">
                            Cancel
                        </button>
                        <button type="button" onclick="saveEditAccount()" 
                                class="px-4 py-2 bg-primary text-white rounded-md hover:bg-secondary focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary">
                            Update Account
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Debug Console -->
    <div id="debugConsole" class="fixed bottom-4 left-4 right-4 bg-black text-green-400 font-mono text-xs rounded-lg shadow-lg border border-gray-600 hidden z-40">
        <div class="flex justify-between items-center px-3 py-2 border-b border-gray-700">
            <span class="text-white font-semibold">Settings Debug Console</span>
            <button onclick="clearDebugConsole()" class="text-yellow-400 hover:text-yellow-300" title="Clear console">
                <i class="fas fa-eraser"></i>
            </button>
            <button onclick="toggleDebugConsole()" class="text-gray-400 hover:text-white ml-2" title="Close console">
                <i class="fas fa-times"></i>
            </button>
        </div>
        <div id="debugOutput" class="p-3 max-h-64 overflow-y-auto">
            <div class="text-gray-500">Debug console ready. All settings actions will be logged here...</div>
        </div>
    </div>
    <button onclick="toggleDebugConsole()" class="fixed bottom-4 right-4 bg-gray-800 text-white px-3 py-2 rounded-full shadow-lg z-50 hover:bg-primary">
        <i class="fas fa-bug"></i> Debug
    </button>
    <script src="/static/js/settings.js"></script>
{% endblock %}
